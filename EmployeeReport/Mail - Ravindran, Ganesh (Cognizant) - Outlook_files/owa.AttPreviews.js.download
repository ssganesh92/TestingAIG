self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.AttPreviews.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[129],{1014:function(t,e,n){"use strict";n.d(e,"e",(function(){return r})),n.d(e,"g",(function(){return i})),n.d(e,"h",(function(){return a})),n.d(e,"n",(function(){return o})),n.d(e,"i",(function(){return c})),n.d(e,"b",(function(){return u})),n.d(e,"c",(function(){return s})),n.d(e,"d",(function(){return d})),n.d(e,"f",(function(){return f})),n.d(e,"j",(function(){return h})),n.d(e,"k",(function(){return m})),n.d(e,"l",(function(){return l})),n.d(e,"m",(function(){return v})),n.d(e,"o",(function(){return w})),n.d(e,"p",(function(){return I})),n.d(e,"q",(function(){return A})),n.d(e,"a",(function(){return b}));var r="FileAttachment:#Exchange",i="ItemAttachment:#Exchange",a="ItemIdAttachment:#Exchange",o="ReferenceAttachment:#Exchange",c="LinkAttachment:#Exchange",u="Box",s="Dropbox",d="Facebook",f="GDrive",h="Mailbox",m="MailMessage",l="OneDriveConsumer",v="OneDrivePro",w="WopiBox",I="WopiDropbox",A="WopiEgnyte",b={providers:{BOX:u,DROPBOX:s,FACEBOOK:d,GDRIVE:f,MAILBOX:h,ONE_DRIVE_CONSUMER:l,ONE_DRIVE_PRO:v,RECENT_ATTACHMENTS:"RecentAttachments",WOPI:"Wopi",WOPI_BOX:w,WOPI_EGNYTE:A},attachmentTypes:{FILE_ATTACHMENT_TYPE:r,ITEM_ATTACHMENT_TYPE:i,ITEM_ID_ATTACHMENT_TYPE:a,REFERENCE_ATTACHMENT_TYPE:o,LINK_ATTACHMENT_TYPE:c}}},1036:function(t,e,n){"use strict";n.d(e,"f",(function(){return d})),n.d(e,"n",(function(){return f})),n.d(e,"j",(function(){return h})),n.d(e,"h",(function(){return m})),n.d(e,"m",(function(){return l})),n.d(e,"l",(function(){return v})),n.d(e,"k",(function(){return w})),n.d(e,"i",(function(){return I})),n.d(e,"g",(function(){return A})),n.d(e,"o",(function(){return b}));var r=n(108),i=n(1597);n.d(e,"p",(function(){return i.a}));var a=n(1126);n.d(e,"b",(function(){return a.a}));var o=n(1226);n.d(e,"c",(function(){return o.a}));var c=n(1324);n.d(e,"e",(function(){return c.a})),n.d(e,"d",(function(){return c.b}));var u=n(1014);n.d(e,"a",(function(){return u.a}));var s=new r.c((function(){return Promise.all([n.e(4),n.e(17),n.e(54),n.e(134)]).then(n.bind(null,3109))})),d=new r.a(s,(function(t){return t.addAndInitializeAttachments})),f=new r.a(s,(function(t){return t.setPreviewImageUrl})),h=new r.a(s,(function(t){return t.refreshDownloadUrl})),m=new r.a(s,(function(t){return t.createAttachmentInfo})),l=new r.a(s,(function(t){return t.setAttachmentInfo})),v=new r.a(s,(function(t){return t.refreshThumbnailImageUrl})),w=new r.a(s,(function(t){return t.refreshPreviewImageUrl})),I=new r.b(s,(function(t){return t.getAttachment})),A=new r.b(s,(function(t){return t.checkPendingAttachmentOperation})),b=new r.b(s,(function(t){return t.shouldShowImageView}))},1051:function(t,e,n){"use strict";var r;!function(t){t[t.Unsupported=0]="Unsupported",t[t.Image=1]="Image",t[t.MailItem=2]="MailItem",t[t.CalendarEvent=3]="CalendarEvent",t[t.Wac=4]="Wac",t[t.SuiteExtensions=5]="SuiteExtensions",t[t.Audio=6]="Audio",t[t.Text=7]="Text",t[t.NativeView=8]="NativeView",t[t.GoogleDoc=9]="GoogleDoc",t[t.PdfJs=10]="PdfJs",t[t.ItemAttachment=11]="ItemAttachment",t[t.Video=12]="Video"}(r||(r={})),e.a=r},1074:function(t,e,n){"use strict";var r;!function(t){t[t.ChangePermissions=0]="ChangePermissions",t[t.CopyLink=1]="CopyLink",t[t.Download=2]="Download",t[t.OpenInNewTab=3]="OpenInNewTab",t[t.Preview=4]="Preview",t[t.SaveToCloud=5]="SaveToCloud",t[t.ViewInProvider=6]="ViewInProvider",t[t.ConvertClassicToCloudy=7]="ConvertClassicToCloudy",t[t.ConvertCloudyToClassic=8]="ConvertCloudyToClassic",t[t.ImportCalendarEventAttachment=9]="ImportCalendarEventAttachment",t[t.MoveAttachmentToInline=10]="MoveAttachmentToInline",t[t.RefreshLink=11]="RefreshLink",t[t.IgnoreExpiration=12]="IgnoreExpiration"}(r||(r={})),e.a=r},1126:function(t,e,n){"use strict";var r=n(24),i=n(4),a={attachments:new r.ObservableMap({})},o=Object(i.createStore)("attachment",a);e.a=o},1226:function(t,e,n){"use strict";var r=function(t){return t&&["IPM.Note","IPM.Schedule.Meeting","IPM.GroupMailbox.JoinRequest","IPM.Post"].includes(t)},i=n(9),a=n(1014);function o(t){switch(t.__type){case a.e:return 0;case a.n:return t.IsLink?3:1;case a.i:return 3;case a.g:return 2;case a.h:var e=t;return r(t.EmbeddedItemClass)||Object(i.f)(e.AttachmentIdToAttach)?2:0;default:throw new Error("Invalid type of attachment "+t.__type)}}n.d(e,"a",(function(){return o}))},1235:function(t,e,n){"use strict";n.d(e,"n",(function(){return c})),n.d(e,"q",(function(){return u})),n.d(e,"r",(function(){return s})),n.d(e,"a",(function(){return d})),n.d(e,"p",(function(){return f})),n.d(e,"f",(function(){return h})),n.d(e,"u",(function(){return m})),n.d(e,"g",(function(){return l})),n.d(e,"d",(function(){return v})),n.d(e,"e",(function(){return w})),n.d(e,"j",(function(){return I})),n.d(e,"i",(function(){return A})),n.d(e,"l",(function(){return b})),n.d(e,"k",(function(){return P})),n.d(e,"c",(function(){return g})),n.d(e,"o",(function(){return _})),n.d(e,"s",(function(){return O})),n.d(e,"b",(function(){return p})),n.d(e,"m",(function(){return E})),n.d(e,"h",(function(){return T})),n.d(e,"t",(function(){return C}));var r=n(108),i=n(1387);n.d(e,"v",(function(){return i.a}));var a=n(1388);n.d(e,"w",(function(){return a.a}));n(1051),n(1074);var o=new r.c((function(){return Promise.all([n.e(0),n.e(1),n.e(2),n.e(3),n.e(139)]).then(n.bind(null,2632))})),c=new r.a(o,(function(t){return t.initializeAttachments})),u=new r.a(o,(function(t){return t.reinitializeAttachments})),s=new r.a(o,(function(t){return t.setInlineAttachmentStatus})),d=new r.a(o,(function(t){return t.addAttachmentIntoWellBeforeUpload})),f=new r.b(o,(function(t){return t.refreshSharingTipsAttachmentWell})),h=new r.b(o,(function(t){return t.createAttachmentsViaQueueManager})),m=new r.b(o,(function(t){return t.createAttachmentsFromRecentAttachments})),l=new r.a(o,(function(t){return t.deleteAttachmentViaQueueManager})),v=new r.b(o,(function(t){return t.createAttachmentFullViewStateAndStoreBackingModel})),w=new r.b(o,(function(t){return t.createAttachmentFullViewState})),I=new r.b(o,(function(t){return t.getAttachmentWellInitialValue})),A=new r.b(o,(function(t){return t.getAttachmentWellForCompose})),b=new r.b(o,(function(t){return t.getConversationAttachmentWellInitialValue})),P=(new r.b(o,(function(t){return t.getMaxClassicAttachmentsSize})),new r.b(o,(function(t){return t.getAvailableLocalAttachmentSize}))),g=new r.b(o,(function(t){return t.createAttachmentFileFromExistingMailboxAttachment})),_=new r.a(o,(function(t){return t.mergeToConversationAttachmentWell})),O=new r.a(o,(function(t){return t.sortConversationAttachmentWell})),p=new r.a(o,(function(t){return t.convertImageViewAttachmentToInlineAttachment})),E=new r.b(o,(function(t){return t.getLastCloudyAttachmentsSharingIssueForBlockOnSend})),T=new r.b(o,(function(t){return t.getAllValidAttachments})),C=new r.b(o,(function(t){return t.uploadLocalFile}))},1324:function(t,e,n){"use strict";function r(t){return(null==t?void 0:t.AttachmentId)&&i(t.AttachmentId.Id)}function i(t){return t&&-1!==t.indexOf("smime-")}n.d(e,"a",(function(){return r})),n.d(e,"b",(function(){return i}))},1387:function(t,e,n){"use strict";var r=n(4);e.a=Object(r.action)("ON_ATTACHMENT_CREATED",(function(t,e,n){return{parentItemId:t,attachmentId:e,attachment:n}}))},1388:function(t,e,n){"use strict";var r=n(4);e.a=Object(r.action)("ON_ATTACHMENT_DELETED",(function(t,e,n){return{parentItemId:t,attachmentId:e,attachment:n}}))},15190:function(t,e,n){"use strict";n.r(e);var r=n(0),i=n(283),a=n(971),o=Object(i.action)("removeAttachmentPreviewsForRow")((function(t){var e=a.a.rowAttachmentPreviewWellViews,n=e.get(t);if(n){var r=a.a.attachmentViewStates;n.imageViewStateIds.forEach((function(t){r.delete(t)})),n.documentViewStateIds.forEach((function(t){r.delete(t)})),e.delete(t)}}));var c=n(254),u=n(1036),s=n(1235),d=n(963),f=n(428),h=n(24);var m=Object(i.action)("createAndStoreAttachmentViewState")((function(t,e,n,i,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){var c,d,f,m=this;return Object(r.__generator)(this,(function(l){switch(l.label){case 0:return c=function(t,e){return t+"_"+e}(t,n.AttachmentId.Id),d=a.a.attachmentViewStates.get(c),f=h.observable.object(Object(r.__assign)(Object(r.__assign)({},n.AttachmentId),{mailboxInfo:o})),[4,s.d.import().then((function(t){return Object(r.__awaiter)(m,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return d=d||t(f,n,!0,!0,!1,!1,e),[4,u.i.import()];case 1:return n=r.sent()(f).model,a.a.attachmentViewStates.set(c,d),[4,u.o.import()];case 2:return r.sent()(n)?i.imageViewStateIds.push(c):i.documentViewStateIds.push(c),[2]}}))}))}))];case 1:return l.sent(),[2]}}))}))}));var l=Object(i.select)({listView:function(){return a.a}})(Object(i.action)("processAttachmentsForConversation")((function(t,e,n){var r,i=n.listView.conversationItems.get(t.ConversationId.Id);if(i){var a=[];if((null===(r=t.AttachmentPreviews)||void 0===r?void 0:r.Previews)&&(a=I(t.AttachmentPreviews.Previews)),a.length>0){var u=function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n],a=i.Attachment,o=-1;if(a.IsInline)for(var c=0;c<e.length;c++){var u=e[c];if(u.Attachment.IsInline&&u.Attachment.Name==a.Name&&u.ParentItemId.Id!=i.ParentItemId.Id){o=c;break}}-1==o&&e.push(i)}return e}(t.AttachmentPreviews.Previews);w(t.ConversationId.Id,u,e);var s=t.AttachmentPreviews.Previews.length-u.length;s>0&&Object(c.p)("IP_II_DP",[s])}else i.shouldShowAttachmentPreviews=!1,o(t.ConversationId.Id),Object(c.p)("IP_FP")}}))),v=Object(i.action)("processAttachmentPreviewsForItems")((function(t,e,n){var i=t.filter((function(t){return t.AttachmentPreviews})),a=[];i.forEach((function(t){a.push.apply(a,Object(r.__spread)(t.AttachmentPreviews.Previews))}));var c=I(a),u={};c.forEach((function(t){var n=t.ParentItemId.Id;e.indexOf(n)>-1&&(u[n]||(u[n]=[]),u[n].push(t))})),e.forEach((function(t){var e=d.w.items.get(t);e?u[t]?w(t,u[t],n):(e.shouldShowAttachmentPreviews=!1,o(t)):delete u[t]}))})),w=Object(i.action)("processAttachmentsForRow")((function(t,e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,o=this;return Object(r.__generator)(this,(function(c){switch(c.label){case 0:return i={documentViewStateIds:[],imageViewStateIds:[]},[4,Promise.all(e.map((function(e){return Object(r.__awaiter)(o,void 0,void 0,(function(){return Object(r.__generator)(this,(function(a){switch(a.label){case 0:return e.Attachment.AttachmentId.Id||(e.Attachment.AttachmentId.Id=Object(f.a)()),[4,m(t,Object(r.__assign)(Object(r.__assign)({},e.ParentItemId),{mailboxInfo:n}),e.Attachment,i,n)];case 1:return a.sent(),[2]}}))}))})))];case 1:return c.sent(),a.a.rowAttachmentPreviewWellViews.set(t,i),[2]}}))}))}));function I(t){var e=t.filter(A);if(e.length!==t.length){var n=t.filter((function(t){return!A(t)})).map((function(t){return t.Attachment.AttachmentId?t.Attachment.AttachmentId.Id:"UNDEFINED"})).join(",");Object(c.o)("InvalidAttachmentPreview",{AttachmentIdString:n})}return e}function A(t){return!!t.Attachment.Name}var b=n(9034),P=n(7247);function g(t,e,n){var i=Object(P.a)(Object(r.__assign)(Object(r.__assign)({},n),{ConversationIds:t}));return Object(b.a)(i,e).then((function(t){return t}))}var _=n(947),O=n(295),p=new Map,E=Object(i.select)({rowIdsToGetPreviewsMap:function(){return p}})(Object(i.action)("AttachmentPreviewsOperations.add")((function(t,e,n,r){var i=r.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress];i||(i={conversationsIdsArray:[],itemIdsArray:[]},r.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]=i),i.conversationsIdsArray.some((function(t){return t.Id==e.Id}))||i.conversationsIdsArray.push(e),-1==i.itemIdsArray.indexOf(n)&&i.itemIdsArray.push(n)}))),T=Object(i.select)({rowIdsToGetPreviewsMap:function(){return p}})(Object(i.action)("AttachmentPreviewsOperations.getPreviews")((function(t,e,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var i,a,o,c,u;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(i=n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress]))return[2];a=i.conversationsIdsArray,o=i.itemIdsArray,c=Object(O.a)(),delete n.rowIdsToGetPreviewsMap[null==t?void 0:t.mailboxSmtpAddress],r.label=1;case 1:return r.trys.push([1,3,,4]),[4,g(a,null==t?void 0:t.requestOptions,{IncludeInlineAttachments:c})];case 2:return void 0!==(u=r.sent()).Conversations?1==e?v(u.Conversations,o,t):function(t,e){t.forEach((function(t){l(t,e)}))}(u.Conversations,t):C(e,o,a),[3,4];case 3:return r.sent(),C(e,o,a),[3,4];case 4:return[2]}}))}))})));function C(t,e,n){1==t?e.forEach((function(t){var e=d.w.items.get(t);e&&(_.T.rowAttachmentPreviewWellViews.get(t)||(e.shouldShowAttachmentPreviews=!1))})):n.forEach((function(t){var e=t.Id,n=_.T.conversationItems.get(e);n&&(_.T.rowAttachmentPreviewWellViews.get(e)||(n.shouldShowAttachmentPreviews=!1))}))}var j=Object(i.action)("AttachmentPreviewsOperations.getAttachmentsForConversationWell")((function(t){var e;return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,i,a,o,c;return Object(r.__generator)(this,(function(u){switch(u.label){case 0:n=[t],i=[],a={},o={},u.label=1;case 1:return u.trys.push([1,3,,4]),[4,g(n,null===(e=t.mailboxInfo)||void 0===e?void 0:e.requestOptions,{FullPreviewsPerConversation:300,PreviewsPerConversation:300,MinimumAttachmentSize:0,IncludeInlineAttachments:!1})];case 2:return void 0!==(c=u.sent()).Conversations&&c.Conversations.forEach((function(e){e.ConversationId.Id==t.Id&&e.AttachmentPreviews&&e.AttachmentPreviews.Previews&&I(e.AttachmentPreviews.Previews).forEach((function(e){i.push(e.Attachment),a[e.Attachment.AttachmentId.Id]=Object(r.__assign)(Object(r.__assign)({},e.ParentItemId),{mailboxInfo:t.mailboxInfo}),o[e.Attachment.AttachmentId.Id]=e.ItemReceivedTime}))})),[3,4];case 3:return u.sent(),[3,4];case 4:return[2,[i,a,o]]}}))}))}));n.d(e,"getPreviews",(function(){return T})),n.d(e,"add",(function(){return E})),n.d(e,"getAttachmentsForConversationWell",(function(){return j})),n.d(e,"removeAttachmentPreviewsForRow",(function(){return o}))},1597:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(4),i=Object(r.action)("REFRESH_SHARING_TIPS_FOR_ATTACHMENT",(function(t){return{attachmentId:t}}))},428:function(t,e,n){"use strict";n.d(e,"a",(function(){return a})),n.d(e,"b",(function(){return o}));var r=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/;function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function a(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}function o(t){return r.test(t)}},7247:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(0);function i(t){return Object(r.__assign)({__type:"GetAttachmentPreviewsRequest:#Exchange"},t)}},9034:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(25),i=n(7247);function a(t,e){return void 0===t||t.__type||(t=Object(i.a)(t)),Object(r.a)("GetAttachmentPreviews",t,e)}}}]);
//# sourceMappingURL=owa.AttPreviews.js.map
self.scriptsLoaded['owa.AttPreviews.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.AttPreviews.js'] = (new Date()).getTime();