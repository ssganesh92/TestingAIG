self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.PersonaPhoto.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[472],{1023:function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return b}));var n=r(1147),i=r(1003),a=r(967),s=r(314),o=r(5),c="email",u="personId",l="UA",d="size",f="/service.svc/s/GetPersonaPhoto";function h(e,t,r,a){if(Object(i.a)()&&e)return Object(n.a)(e,r);var s=Object(o.a)().baseUrl,h="";return e&&(h=m(h,c,e&&e.toLowerCase())),t&&(h=m(h,u,t)),h=m(h,l,"0"),h=m(h,d,a?"HR96x96":"HR64x64"),""+s+f+"?"+h}function b(e,t,r){return Object(i.a)()?Object(n.a)(e,t):"https://cid-"+e+".users.storage.live.com/users/0x"+e+"/myprofile/expressionprofile/profilephoto:"+function(e){switch(e){case a.c.tiny:case a.c.extraExtraSmall:case a.c.extraSmall:case a.c.small:case a.c.regular:case a.c.large:case a.c.size10:case a.c.size8:case a.c.size16:case a.c.size24:case a.c.size28:case a.c.size32:return"UserTileStatic,UserTileSmall";case a.c.extraLarge:case a.c.size40:case a.c.size48:case a.c.size56:case a.c.size72:case a.c.size100:case a.c.size120:return"UserTileMedium,UserTileStatic,UserTileSmall";default:return Object(s.a)(e)}}(r)+"/MeControlMediumUserTile?ck=1&ex=24&fofoff=1"}function m(e,t,r){r&&(r=encodeURIComponent(r));var n=t+"="+r;return e&&(n=e+"&"+n),n}},1147:function(e,t,r){"use strict";r.d(t,"a",(function(){return a}));var n=r(9),i="/profile/v1.0/{0}/{1}/image/$value";function a(e,t){var r=e.indexOf("@")>-1,a="GroupMailbox"==t?"groups":"users";return Object(n.c)(i,a,r?e:"cid:"+e)}},1215:function(e,t,r){"use strict";var n=r(0),i=r(283),a=Object(i.action)("setIsPendingFetch")((function(e,t){e.personaBlob.isPendingFetch=t})),s=r(4),o=r(957),c=Object(s.mutatorAction)("addBrandToDynamicBrandSet",(function(e,t){t?o.a.dynamicBrandSets.verifiedBrands.set(e,!0):o.a.dynamicBrandSets.unverifiedBrands.set(e,!0)})),u=r(1147),l=r(1023),d=r(1003),f=r(254),h=r(9),b=r(699),m=r(79),p=r(110),v=r(109),g=r(76);r.d(t,"a",(function(){return S}));var z="GetProfileImageTime",O="GetPersonaTime",x="GetProfileImageNoPhoto",w="GetPersonaResponseNoPhoto",j="https://outlook.office.com/M365.Access",y="image_verified_flag",k="outlook.brands.verified_status",P={};function S(e,t,r){return Object(n.__awaiter)(this,void 0,void 0,(function(){var i,s;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:if(i=e.personaBlob,!t&&(i.isPendingFetch||i.hasFetchFailed||i.blobUrl&&P[i.blobUrl]||Object(h.f)(e.emailAddress)&&Object(h.f)(e.personaId)||(null==r?void 0:r())))return[2];a(e,!0),n.label=1;case 1:return n.trys.push([1,3,4,5]),[4,Object(d.a)()?R(e,t):A(e,t)];case 2:return n.sent(),[3,5];case 3:throw s=n.sent(),m.g.warn("Error in getPersonaPhoto "+s),s;case 4:return a(e,!1),[7];case 5:return[2]}}))}))}function A(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,a,s,o,c;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return r=T(),i=new Headers,t&&i.append("Cache-Control","no-cache"),(a=Object(v.a)({isUserActivity:!1,returnFullResponseOnSuccess:!0,headers:i,method:"GET"})).credentials="same-origin",a.headers.has("X-OWA-CANARY")&&a.headers.delete("X-OWA-CANARY"),a.headers.has("X-Req-Source")&&a.headers.delete("X-Req-Source"),[4,Object(p.a)(Object(l.a)(e.emailAddress,e.personaId),a)];case 1:return s=n.sent(),o=B,c=[e],[4,s.blob()];case 2:return o.apply(void 0,c.concat([n.sent()])),r.end(),[2]}}))}))}function R(e,t){return Object(n.__awaiter)(this,void 0,void 0,(function(){var r,i,a,s,o,l;return Object(n.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(b.getDelegationTokenForOwa)(j)];case 1:return(r=n.sent())?(i=Object(u.a)(e.emailAddress,e.mailboxType),a={"Content-Type":"image/gif",Authorization:"Bearer "+r,"X-AnchorMailbox":e.emailAddress,image_verified_flag:"","X-RoutingParameter-ResolutionDepth":"Shallow"},t&&(a["Cache-Control"]="no-cache"),s=T(),[4,fetch(i,{method:"GET",mode:"cors",headers:a})]):[2];case 2:return o=n.sent(),Object(d.a)()&&Object(g.h)("rp-brandCardsFromImageApi")&&function(e,t){var r=t.headers.get(y);if(null!=r){var n=r.toLowerCase(),i=-1!==n.indexOf(k),a=-1!==n.indexOf(k+" = true");i&&c(e.emailAddress,a)}}(e,o),[4,o.blob()];case 3:return l=n.sent(),B(e,l),s.end(),[2]}}))}))}function T(){var e=Object(d.a)()?z:O;return new f.b(e)}var B=Object(i.action)("processGetPhotoResponse")((function(e,t){a(e,!1);var r,n=0==t.type.toLowerCase().indexOf("image"),i=0==t.type.toLowerCase().indexOf("text/xml"),s=t.size<100;if((n||i)&&!s)return e.personaBlob.blobUrl=URL.createObjectURL(t),P[e.personaBlob.blobUrl]=!0,void(e.personaBlob.hasFetchFailed=!1);r=Object(d.a)()?x:w,Object(f.p)(r),e.personaBlob.hasFetchFailed=!0}))},14859:function(e,t,r){"use strict";r.r(t);var n=r(1215);r.d(t,"downloadPersonaPhoto",(function(){return n.a}))},241:function(e,t,r){"use strict";function n(){var e=Object.create(null),t=0,r=0,n=0,i=!1;function a(t){n--,delete e[t]}this.put=function(t,r,i,s){if(void 0!==i&&("number"!=typeof i||isNaN(i)||i<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==s&&"function"!=typeof s)throw new Error("Cache timeout callback must be a function");var o=e[t];o?clearTimeout(o.timeout):n++;var c={value:r,expire:i+Date.now()};return isNaN(c.expire)||(c.timeout=setTimeout(function(){a(t),s&&s(t,r)}.bind(this),i)),e[t]=c,r},this.del=function(t){var r=!0,n=e[t];return n?(clearTimeout(n.timeout),!isNaN(n.expire)&&n.expire<Date.now()&&(r=!1)):r=!1,r&&a(t),r},this.clear=function(){for(var a in e)clearTimeout(e[a].timeout);n=0,e=Object.create(null),i&&(t=0,r=0)},this.get=function(a){var s=e[a];if(void 0!==s){if(isNaN(s.expire)||s.expire>=Date.now())return i&&t++,s.value;i&&r++,n--,delete e[a]}else i&&r++;return null},this.size=function(){return n},this.memsize=function(){var t,r=0;for(t in e)r++;return r},this.debug=function(e){i=e},this.hits=function(){return t},this.misses=function(){return r},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var r in e){var n=e[r];t[r]={value:n.value,expire:n.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,r){var n=JSON.parse(t),i=Date.now(),a=r&&r.skipDuplicates;for(var s in n)if(n.hasOwnProperty(s)){if(a)if(e[s])continue;var o=n[s],c=o.expire-i;if(c<=0){this.del(s);continue}c=c>0?c:void 0,this.put(s,o.value,c)}return this.size()}}e.exports=new n,e.exports.Cache=n},428:function(e,t,r){"use strict";r.d(t,"a",(function(){return a})),r.d(t,"b",(function(){return s}));var n=/^[0-9a-z]{8}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{4}-[0-9a-z]{12}$/;function i(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}function a(){return i()+i()+"-"+i()+"-"+i()+"-"+i()+"-"+i()+i()+i()}function s(e){return n.test(e)}},967:function(e,t,r){"use strict";var n,i,a;r.d(t,"c",(function(){return n})),r.d(t,"b",(function(){return i})),r.d(t,"a",(function(){return a})),function(e){e[e.tiny=0]="tiny",e[e.extraExtraSmall=1]="extraExtraSmall",e[e.extraSmall=2]="extraSmall",e[e.small=3]="small",e[e.regular=4]="regular",e[e.large=5]="large",e[e.extraLarge=6]="extraLarge",e[e.size8=17]="size8",e[e.size10=9]="size10",e[e.size16=8]="size16",e[e.size24=10]="size24",e[e.size28=7]="size28",e[e.size32=11]="size32",e[e.size40=12]="size40",e[e.size48=13]="size48",e[e.size56=16]="size56",e[e.size72=14]="size72",e[e.size100=15]="size100",e[e.size120=18]="size120"}(n||(n={})),function(e){e[e.none=0]="none",e[e.offline=1]="offline",e[e.online=2]="online",e[e.away=3]="away",e[e.dnd=4]="dnd",e[e.blocked=5]="blocked",e[e.busy=6]="busy"}(i||(i={})),function(e){e[e.lightBlue=0]="lightBlue",e[e.blue=1]="blue",e[e.darkBlue=2]="darkBlue",e[e.teal=3]="teal",e[e.lightGreen=4]="lightGreen",e[e.green=5]="green",e[e.darkGreen=6]="darkGreen",e[e.lightPink=7]="lightPink",e[e.pink=8]="pink",e[e.magenta=9]="magenta",e[e.purple=10]="purple",e[e.black=11]="black",e[e.orange=12]="orange",e[e.red=13]="red",e[e.darkRed=14]="darkRed",e[e.transparent=15]="transparent",e[e.violet=16]="violet",e[e.lightRed=17]="lightRed",e[e.gold=18]="gold",e[e.burgundy=19]="burgundy",e[e.warmGray=20]="warmGray",e[e.coolGray=21]="coolGray",e[e.gray=22]="gray",e[e.cyan=23]="cyan",e[e.rust=24]="rust"}(a||(a={}))}}]);
//# sourceMappingURL=owa.PersonaPhoto.js.map
self.scriptsLoaded['owa.PersonaPhoto.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.PersonaPhoto.js'] = (new Date()).getTime();