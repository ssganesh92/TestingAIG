self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.CharmsCatalog.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[207],{15188:function(e,r,n){"use strict";n.r(r);var t=n(0),o=n(1071),a=n(27),c=n(147),l=n(287),i=n(79),u="ows/v1.0/CalendarIcons/?AssetType=svg&Lang=",s=2,f=null;var d=n(283);function h(e){var r,n,o={IconId:e.iconId,Name:e.name,LocalizedName:e.locName,SvgFile:e.svgFile,Keywords:[],IsInDefaultSet:e.isInDefaultSet,SvgHtmlText:""};if(null!=e.keywords)try{for(var a=Object(t.__values)(e.keywords),c=a.next();!c.done;c=a.next()){var l=c.value;o.Keywords.push(l)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o}var v=Object(d.action)("setCharmInfoInMap")(Object(d.select)({charmStore:function(){return o.a}})((function(e,r){var n=r.charmStore;return new Promise((function(r){var o,a;if(null==n||null==n.charmInfoMap||null==e||null==e.icons)return r();try{for(var c=Object(t.__values)(e.icons),l=c.next();!l.done;l=c.next()){var i=l.value,u=h(i);n.charmInfoMap.set(i.iconId.toString(),u)}}catch(e){o={error:e}}finally{try{l&&!l.done&&(a=c.return)&&a.call(c)}finally{if(o)throw o.error}}return r()}))}))),m=Object(d.action)("setCharmKeywordsInMap")(Object(d.select)({charmStore:function(){return o.a}})((function(e){var r=e.charmStore;return new Promise((function(e){var n,o;if(null==r||null==r.keywordsMap||null==r.charmInfoMapMaxId)return e();if(r.keywordsMap.size>3)return e();for(var a=0;a<=r.charmInfoMapMaxId;a++){var c=r.charmInfoMap.get(a.toString());if(null!=c)try{for(var l=(n=void 0,Object(t.__values)(c.Keywords)),i=l.next();!i.done;i=l.next()){var u=i.value;if(!r.keywordsMap.has(u)){var s={Keyword:u,IconId:c.IconId};r.keywordsMap.set(u.toLocaleLowerCase(),s)}}}catch(e){n={error:e}}finally{try{i&&!i.done&&(o=l.return)&&o.call(l)}finally{if(n)throw n.error}}}return e()}))})));var g=Object(d.action)("loadCharmsCatalog")(Object(d.select)({charmStore:function(){return o.a}})((function(e){var r=e.charmStore;return new Promise((function(e){var n=function(){if(null!=f)return f;var e=Object(a.a)(),r="";if((null==e?void 0:e.SessionSettings)&&!Object(c.b)(e.SessionSettings.UserCulture)&&(r=e.SessionSettings.UserCulture.toLowerCase()),r.length<s)return i.d("[getCalendarIconsFromService] Failed to get locale, got: "+r+"."),null;var n=u+r;return f=new Promise((function(e){Object(l.b)(n).then((function(n){return null!=n?(i.g.info("[getCalendarIconsFromService] Got response for locale: "+r+"."),e(n)):(i.d("[getCalendarIconsFromService] Failed to get response for locale: "+r+"."),e(null))}))}))}();null!=n&&n.then((function(e){return null!=e&&null!=e.icons&&e.icons.length>0?(v(e),r.charmInfoMapMaxId=function(e){var r,n,o=0;try{for(var a=Object(t.__values)(e),c=a.next();!c.done;c=a.next()){var l=c.value;o<l.iconId&&(o=l.iconId)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(n=a.return)&&n.call(a)}finally{if(r)throw r.error}}return o}(e.icons),m(),void i.g.info("[loadCharmsCatalog] Loaded charms catalog into the charms store.")):void i.g.info("[loadCharmsCatalog] Failed to load charms from service. Continuing without charms.")})).then((function(){return e()}))}))}))),I=n(8446);function w(e,r){return Object(t.__awaiter)(this,void 0,void 0,(function(){return Object(t.__generator)(this,(function(r){switch(r.label){case 0:return[4,Object(I.a)(e.SvgFile).then((function(r){e.SvgHtmlText=r}))];case 1:return r.sent(),i.g.info("[setCharmInfoWithUpdatedSvgText] complete, iconId: "+e.IconId),[2]}}))}))}var S=Object(d.action)("loadCharmSvgTextInMap")(Object(d.select)({charmStore:function(){return o.a}})((function(e,r){return Object(t.__awaiter)(this,void 0,void 0,(function(){var n;return Object(t.__generator)(this,(function(t){switch(t.label){case 0:return null==e||null==r||null==r.charmStore||null==r.charmStore.charmInfoMapMaxId?[2]:null==(n=r.charmStore.charmInfoMap.get(e.toString()))||null!=n.SvgHtmlText&&""!=n.SvgHtmlText?[3,2]:[4,w(n,r.charmStore)];case 1:t.sent(),r.charmStore.charmInfoMap.set(n.IconId.toString(),n),t.label=2;case 2:return[2]}}))}))})));n.d(r,"loadCharmsCatalog",(function(){return g})),n.d(r,"loadCharmSvgTextInMap",(function(){return S}))},8446:function(e,r,n){"use strict";r.a=function(e){if(null==e||""==e)return Promise.resolve("");var r=new Request(e);return r.headers.append("Content-Type","application/x-www-form-urlencoded; charset=UTF-8"),r.headers.append("Accept","application/x-www-form-urlencoded; charset=UTF-8"),fetch(r).then((function(e){return e.text()}))}}}]);
//# sourceMappingURL=owa.CharmsCatalog.js.map
self.scriptsLoaded['owa.CharmsCatalog.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.CharmsCatalog.js'] = (new Date()).getTime();