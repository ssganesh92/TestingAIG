self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.4.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[4],{338:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"c",(function(){return s})),n.d(t,"b",(function(){return a}));var r=n(241),o=null,i=3e4;function c(){return null==o&&(o=new r.Cache),o}function u(e){return c().get(e)}function s(e){return c().del(e)}function a(e,t){c().put(e,t,i)}},383:function(e,t,n){"use strict";var r=n(0),o=n(241),i=n(270),c=n(340);function u(e){return Object(r.__assign)({__type:"TokenRequest:#Exchange"},e)}var s=n(120),a=n(25);function l(e,t){return void 0===e||e.__type||(e=u(e)),Object(a.a)("GetAccessTokenforResource",e,t)}var d=n(71),f=n(98),h="OWA_GetAccessTokenForResource";function _(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,Object(d.a)()];case 1:return(o=r.sent())&&e==Object(f.a)()?[2,{AccessToken:o}]:(i={isUserActivity:!1,datapoint:{customData:{Scenario:h,Resource_Url:e,Retry_attempt:t,Request_Id:n},headersCustomData:function(e){return{TokenResultDetails:e.get("x-tokenresult")}},jsonCustomData:function(e){var t;return{TokenStatus:(null===(t=null==e?void 0:e.TokenResultCode)||void 0===t?void 0:t.toString())||2}}},returnFullResponseOnSuccess:!0},[4,l(u({Resource:e,UserToken:o}),i)]);case 2:return[4,r.sent().json()];case 3:return[2,r.sent()]}}))}))}function b(e,t,n,o){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(r){return t<1?[2,Promise.reject()]:[2,_(e,t,o).catch((function(r){return Object(s.a)(n).then((function(){return b(e,t-1,2*n,o)}))}))]}))}))}var v,p=n(76),O=n(482),g=3,j=500;function k(e,t){var n=this,o=null,i=null,c=new Promise((function(e,t){return Object(r.__awaiter)(n,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return o=e,i=t,[2]}))}))})),u={onFulfilled:o,onRejected:i,resource:e,requestId:t};return(null==v&&(v=new O.a(g,A,j)),v).add(u),c}function A(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return x(e.resource,e.requestId).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),[2]}))}))}var w=n(338),T=n(123),m=n(428);n.d(t,"d",(function(){return D})),n.d(t,"b",(function(){return E})),n.d(t,"c",(function(){return q})),n.d(t,"a",(function(){return x}));var I=1,C=8e3,y=3,R=1500,S=null;function D(e){S=e}function E(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return n=U(F(),e),t=t||Object(m.a)(),null!=n?[3,2]:[4,x(e,t)];case 1:n=r.sent(),r.label=2;case 2:return[2,null!=n?n.AccessToken:void 0]}}))}))}function q(e,t){t=t||Object(m.a)();var n=U(F(),e);if(n)return[n.AccessToken,void 0];if(Object(p.h)("auth-getAccessTokenQueueEnabled")){var r=Object(w.a)(e),o=void 0;return r?o=r:(o=k(e,t),Object(w.b)(e,o)),[void 0,o.then((function(t){return Object(w.c)(e),t.AccessToken})).catch((function(n){Object(w.c)(e),Object(T.h)(h,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",stk:n?n.stack:"",resource:e,requestId:t})}))]}return[void 0,x(e,t).then((function(e){return e.AccessToken}))]}function x(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,o,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return Object(p.h)("auth-getAccessTokenQueueEnabled")?[4,b(e,y,R,t)]:[3,2];case 1:return o=r.sent(),[3,4];case 2:return[4,_(e,y,t)];case 3:o=r.sent(),r.label=4;case 4:return null!=(n=o)&&0==n.TokenResultCode&&null!=n.AccessTokenExpiry&&(n.ExpiresIn&&n.ExpiresIn>0&&(n.AccessTokenExpiry=Object(c.a)(Date.now(),n.ExpiresIn).toISOString()),(i=new Date(n.AccessTokenExpiry).getTime()-Date.now()-C)>0&&F().put(e,n,i,(function(e,n){x(e,t).catch((function(n){Object(T.h)(h,{category:"Cache_Expired",err:n?n.toString():"",message:n?n.message:"",stk:n?n.stack:"",resource:e,requestId:t})}))}))),[2,n]}}))}))}function U(e,t){var n=e.get(t),r=void 0;(null==n?void 0:n.AccessTokenExpiry)&&n.AccessToken&&(Object(i.a)(new Date(n.AccessTokenExpiry),-I)>new Date(Date.now())&&(r=n));return r}function F(){return null==S&&(S=new o.Cache),S}},699:function(e,t,n){"use strict";n.r(t);var r=n(241),o=n(383);function i(e){Object(o.d)(new r.Cache),Object(o.b)(e.location.origin)}var c=n(0),u=n(58),s=n(107),a=n(340),l=n(123),d="OWA_GetDelegationAccessToken",f={};function h(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(c.__generator)(this,(function(r){switch(r.label){case 0:t=encodeURIComponent(e.client_id+e.scope+e.requestId),n={},r.label=1;case 1:return r.trys.push([1,3,4,5]),[4,_(e,window,t)];case 2:return n=r.sent(),[3,5];case 3:return r.sent(),n.TokenResultCode=2,[3,5];case 4:return function(e,t){var n=t.document.getElementById(e);null!=n&&(n.removeEventListener("load",f[e]),t.document.body.removeChild(n),delete f[e])}(t,window),[7];case 5:return[2,n]}}))}))}function _(e,t,n){return Object(c.__awaiter)(this,void 0,void 0,(function(){var r,o;return Object(c.__generator)(this,(function(i){return r=function(e){var t={response_type:"token",prompt:"none",redirect_uri:e.redirect_uri,scope:e.scope,client_id:e.client_id};return e.authorization_uri+"?"+u.stringify(t)}(e),t.document.getElementById(n)?[2,{TokenResultCode:2}]:((o=t.document.createElement("iframe")).src=r.toString(),o.style.display="none",o.id=n,t.document.body.appendChild(o),[2,new Promise((function(r,i){f[n]=function(n){var c={};try{o.contentWindow&&o.contentWindow.location.host==t.location.host&&(c=function(e,t){var n=u.parse(e),r={};n.access_token?(r.AccessToken=n.access_token,r.AccessTokenExpiry=Object(a.a)(Date.now(),parseInt(n.expires_in)).toISOString(),r.TokenResultCode=0):"login_required"==n.error||"interaction_required"==n.error||"consent_required"==n.error?(r.TokenResultCode=3,Object(l.h)(d+" MSA Failure Unauthorized",{error:n.error,param:e,requestId:t})):(r.TokenResultCode=2,Object(l.h)(d+" MSA Failure",{error:n.error,param:e,requestId:t}));return r}(o.contentWindow.location.hash.substring(1),e.requestId))}catch(t){Object(l.h)(d+" Hash Param Parsing Failure ",{err:t.toString(),message:t.message,stk:t.stack||"",scope:e.scope,uri:e.redirect_uri,requestId:e.requestId}),c.TokenResultCode=2,i(c)}r(c)},o.addEventListener("load",f[n],!1)}))])}))}))}var b,v=n(76),p=n(338),O=n(482),g=3,j=1500;function k(e){var t=this,n=null,r=null,o=new Promise((function(e,o){return Object(c.__awaiter)(t,void 0,void 0,(function(){return Object(c.__generator)(this,(function(t){return n=e,r=o,[2]}))}))})),i={onFulfilled:n,onRejected:r,options:e};return(null==b&&(b=new O.a(g,A,j)),b).add(i),o}function A(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){return Object(c.__generator)(this,(function(t){return h(e.options).then((function(t){e.onFulfilled(t)})).catch((function(t){e.onRejected(t)})),[2]}))}))}var w=n(98),T=n(428),m=null,I="OWA_GetDelegationAccessToken",C="https://login.live.com/oauth20_authorize.srf",y="/owa/auth/dt.aspx",R="292841";function S(e,t){return Object(c.__awaiter)(this,void 0,void 0,(function(){var n,r,o,i,a;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:n={scope:e,client_id:"",authorization_uri:"",redirect_uri:"",requestId:t||Object(T.a)()},r=void 0,o=void 0,c.label=1;case 1:return c.trys.push([1,7,,8]),Object(v.h)("auth-disableGetAuthenticationCall")?[4,D(x(n))]:[3,3];case 2:return r=c.sent(),[3,6];case 3:return[4,Object(s.a)()];case 4:return 0!=(o=c.sent()).ResultCode||null==o.ImplicitGrantAuthorizationUrl||""==o.ImplicitGrantAuthorizationUrl?(Object(l.h)(I+" ImplicitGrantAuthorizationUrl is empty or null ",{scope:e,correlationId:n.requestId}),[2,r]):(i=u.parse(o.ImplicitGrantAuthorizationUrl.split("?")[1]||"")).client_id&&i.redirect_uri?(n.client_id=i.client_id,n.authorization_uri=o.ImplicitGrantAuthorizationUrl.split("?")[0],n.redirect_uri=i.redirect_uri,[4,D(n)]):[3,6];case 5:r=c.sent(),c.label=6;case 6:return[2,r];case 7:return a=c.sent(),Object(l.h)(I+" GetDelegationToken Operation failed ",{err:a.toString(),message:a.message,stk:a.stack||"",scope:e,requestId:n.requestId}),[2,r];case 8:return[2]}}))}))}function D(e){return Object(c.__awaiter)(this,void 0,void 0,(function(){var t,n,r,o;return Object(c.__generator)(this,(function(i){switch(i.label){case 0:return t=e.client_id+e.scope,(null==(n=function(e,t){var n=e.get(t),r=void 0;if(null==n?void 0:n.AccessTokenExpiry){new Date(n.AccessTokenExpiry)>new Date(Date.now())&&(r=n)}return r}(q(),t))?void 0:n.AccessToken)?[2,n.AccessToken]:[3,1];case 1:return Object(v.h)("auth-getDelegationTokenQueueEnabled")?(r=Object(p.a)(t),o=void 0,r?o=r:(o=k(e),Object(p.b)(t,o)),[2,o.then((function(e){return E(t,e),Object(p.c)(t),e.AccessToken})).catch((function(n){Object(p.c)(t),Object(l.h)(I,{category:"Promise_For_Token_Request_Failed",err:n?n.toString():"",message:n?n.message:"",scope:e.scope,requestId:e.requestId})}))]):[3,2];case 2:return[4,h(e)];case 3:return n=i.sent(),E(t,n),[2,0==n.TokenResultCode?n.AccessToken:void 0]}}))}))}function E(e,t){if(t&&0==t.TokenResultCode&&t.AccessTokenExpiry){var n=new Date(t.AccessTokenExpiry).getTime()-Date.now();n>0&&q().put(e,t,n)}}function q(){return null==m&&(m=new r.Cache),m}function x(e){return e.redirect_uri=Object(w.a)()+y,e.authorization_uri=C,e.client_id=R,e}var U=n(5),F=n(440);var P=!1;function z(){var e;P||(e=Object(F.a)("/owa"),Object(U.b)({baseUrl:e}),P=!0)}var G={NoUserLogin:"AADSTS50058",InvalidResourceUrl:"AADSTS50001",NoPreAuth:"AADSTS65001",UserAborted:"AADSTS65004",NotConsent:"AADSTS70011"};function W(e,t,n,r,o){n?e.acquireTokenPopup(t,null,n,o):e.acquireToken(t,(function(n,i){n&&n.indexOf(G.NoPreAuth)>=0&&r?e.acquireTokenPopup(t,null,null,o):o(n,i)}))}var N=n(108),L=new N.c((function(){return Promise.all([n.e(683),n.e(115)]).then(n.bind(null,15326))})),B=new N.a(L,(function(e){return e.createAdalAuthenticationContext}));var Q=function(e,t,n,r,o){return function(i,c){i||!c?o(i,null):(e.getCachedUser(),W(e,t,n,r,o))}},M="adalIdTokenFrame";function $(e,t,n,r,o){e.config.displayCall=function(i){!function(e){if(-1==e.indexOf("?"))throw new Error("Invalid Url in Adal Auth Context Display Call")}(i),window.detectUserCachedCallback=Q(e,t,n,r,o),function(e,t){e._addAdalFrame(M).src="about:blank",e._loadFrame(t+"&prompt=none",M)}(e,i)},e.login()}var H=n(27);function J(e,t,n,r,o,i){var u,s;return Object(c.__awaiter)(this,void 0,void 0,(function(){var a,l,d,f;return Object(c.__generator)(this,(function(c){switch(c.label){case 0:return"https://login.microsoftonline.com/",[4,B.importAndExecute("https://login.microsoftonline.com/",e,t)];case 1:return a=c.sent(),l=Object(H.a)(),d=null===(u=l.SessionSettings)||void 0===u?void 0:u.UserPrincipalName,f=null===(s=l.SessionSettings)||void 0===s?void 0:s.UserEmailAddress,a._user={profile:{upn:d||f}},a.getCachedUser()?W(a,n,r,o,i):$(a,n,r,o,i),[2]}}))}))}var K=n(71);n.d(t,"registerTokenProvider",(function(){return i})),n.d(t,"getAccessTokenforResource",(function(){return o.b})),n.d(t,"getAccessTokenforResourceAsLazy",(function(){return o.c})),n.d(t,"getDelegationToken",(function(){return D})),n.d(t,"getDelegationTokenForOwa",(function(){return S})),n.d(t,"bootstrap",(function(){return z})),n.d(t,"getAccessTokenOnBehalfOfResource",(function(){return J})),n.d(t,"AdalErrorCode",(function(){return G})),n.d(t,"setUserTokenCallback",(function(){return K.b}))}}]);
//# sourceMappingURL=owa.4.js.map
self.scriptsLoaded['owa.4.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.4.js'] = (new Date()).getTime();