self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.911.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[911],{15059:function(e,t,n){"use strict";n.r(t);var r=n(0),o=n(2305),i=n(1112),a=n(1724),d=n(1727),s=n(79),u=n(947),c=n(973),l=n(1931);function b(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,o;return Object(r.__generator)(this,(function(r){return 1===(n=t.tableQuery).listViewType?(o={Id:e,mailboxInfo:Object(i.c)(n)},[2,d.e.importAndExecute(o,"LoadNudgedItem")]):[2,f(e,t)]}))}))}function f(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,b,f;return Object(r.__generator)(this,(function(r){return n=t.tableQuery,b=Object(i.c)(n),f=Object(l.a)()&&"inbox"==Object(c.a)(n.folderId)?0:-1,[2,a.k.importAndExecute(Object(u.i)(n),e,Object(o.a)(n),n.requestShapeName,b.requestOptions,f).then((function(t){if("Success"==t.ResponseClass){var n=t.Conversations;if(n&&n.length>0&&n[0].ConversationId.Id===e){var r={Id:e,mailboxInfo:b};return d.d.importAndExecute(r,"LoadNudgedConversation"),n[0]}}return null})).catch((function(e){return s.g.warn("loadNudgedConversation throws an exception"+e.message),null}))]}))}))}var w=n(295),g=n(699),I="https://outlook.office.com/FocusedInboxB2";function O(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,m()];case 1:return e=n.sent(),t=new Headers,e&&(t.authorization="Bearer "+e),[2,t]}}))}))}function m(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return Object(w.a)()?[2,null]:[2,Object(g.getAccessTokenforResource)(I)]}))}))}var v=n(287),h="FocusedInboxB2/api/v1/Nudges/GetNudges";function p(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,O()];case 1:return t=r.sent(),[4,Object(v.b)(h,e,!0,t)];case 2:n=r.sent(),r.label=3;case 3:return r.trys.push([3,5,,6]),[4,n.json()];case 4:return[2,r.sent()];case 5:return r.sent(),[2,null];case 6:return[2]}}))}))}var j=n(3),y=n(950);function N(e){switch(e){case"Received":return 0;case"Sent":return 1;default:return s.g.warn("No nudge reason returned in GetNudge server response"),0}}var _=n(3495),R=n(2304),C=n(3897),K=n(9028),x=n(1868),T=n(2058);function A(e,t){var n=t.rowKeys.indexOf(e);if(-1!=n){var r=u.b.getLastDeliveryOrRenewTimeStamp(e,t);if(Object(T.a)(e,t.id,r)){var o=Object(C.a)(r,u.b.getLastDeliveryTimeStamp(e,t),t,n+1);-1==o?Object(R.a)([e],t,"NotNudgeAnymore"):(Object(K.a)([e],t),x.a.updateRowPosition(--o,e,t))}}}var S=n(254),V=n(108),D=n(428),E=n(3573),M=n(1413),L=n(965),P=n(7);function k(e,t,n){Object(S.o)("Nudge_RowRemove",{owa_1:t,owa_2:n,rKey:e},{isCore:!0})}var F=n(6625),U=!1,Q=Object(V.e)(F.a,"getNudgesOnNudgeOptionChangeClone",(function(e){z(Object(u.C)().tableQuery.folderId)})),G=Object(V.e)(E.a,"clone_onSelectFolderComplete",(function(e){e.selectedFolderId==e.previousFolderId||e.isExitingSearch||z(e.selectedFolderId)}));function z(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,o,i,a,d,l,b,f,w,g,I,O,m,v,h,N,R,C;return Object(r.__generator)(this,(function(K){switch(K.label){case 0:return!U&&Object(_.b)()&&Object(_.a)(e)?(t=Object(u.C)(),t.tableQuery.folderId!=e?[2]:(U=!0,n=Object(D.a)(),o=Date.now(),[4,p(n)])):[2];case 1:i=K.sent(),a=i?Date.now()-o:-1,d=[],l=(null==i?void 0:i.Nudges)||[],b=0,f=[],w=[],g="sentitems"==Object(c.a)(e),I=0,K.label=2;case 2:return I<l.length?(O=l[I],m=O.FolderId.Id,v=O.ItemId.Id,f.push(v),g&&m!=e?[3,4]:[4,B(O,t,n)]):[3,5];case 3:(h=K.sent())&&(d.push(h),w.push(v)),b++,K.label=4;case 4:return I++,[3,2];case 5:return Object(S.o)("Nudge_GetNudge",{owa_1:l.length,owa_2:b,owa_3:d.length,cId:n,itemId:f.join(","),latency:a,validItemId:w.join(",")}),N=Object(j.a)("testOldNudge"),0!=decodeURIComponent(N||"").trim().length&&(d.push({rowKey:"testNudgeRowKey",itemId:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId=",conversationId:"getTestNudgeRowDataForRowNotLoadedInTableViewConversationId=",tableViewId:t.id,reason:0,daysAgo:7}),R={ConversationId:{__type:"ItemId:#Exchange",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewConversationId="},ConversationTopic:"This is a test Nudge Email that is older than the loaded rows",UniqueSenders:["Sayali Shah"],LastDeliveryTime:"2019-10-01T15:30:58-07:00",HasAttachments:!1,MessageCount:1,GlobalMessageCount:1,UnreadCount:1,GlobalUnreadCount:1,Size:1234,ItemClasses:["IPM.Note"],Importance:null,ItemIds:[{__type:"ItemId:#Exchange",ChangeKey:"CQAAAA==",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId="}],GlobalItemIds:[{__type:"ItemId:#Exchange",ChangeKey:"CQAAAA==",Id:"getTestNudgeRowDataForRowNotLoadedInTableViewItemId="}],LastModifiedTime:"2019-10-29T15:30:59-07:00",InstanceKey:"testNudgeRowKey",Preview:"Test nudge email for row that is not loaded",HasIrm:!1,IsLocked:!1,FamilyId:{__type:"ItemId:#Exchange",Id:"AAQkAGZjM2NmMGY1LTkzMzgtNGNhMy04ODg5LWQwMjJjMDc0YjJlMAAQAH9+ZbR0rbRFncY81mWHT1E="},LastDeliveryOrRenewTime:"2019-10-01T15:30:58-07:00",HasAttachmentPreviews:!1,LastSender:{Mailbox:{Name:"Sayali Shah",EmailAddress:"sayalis@microsoft.com",RoutingType:"SMTP"}}},t.rowKeys.indexOf("testNudgeRowKey")<0&&(C=Object(M.f)(t,0),x.a.addRow(C,R,t))),d.push.apply(d,Object(r.__spread)(function(e){var t=Object(j.a)("testNudge");if(0==decodeURIComponent(t||"").trim().length)return[];var n=[];if(e.rowKeys.length>0){var r=e.tableQuery.folderId===Object(y.a)("sentitems")?1:0,o={rowKey:e.rowKeys[4],itemId:u.b.getItemIds(e.rowKeys[0],e)[0],conversationId:u.b.getConversationId(e.rowKeys[4],e),tableViewId:e.id,reason:r,daysAgo:1};if(n.push(o),e.rowKeys.length>3){var i={rowKey:e.rowKeys[6],itemId:u.b.getItemIds(e.rowKeys[3],e)[0],conversationId:u.b.getConversationId(e.rowKeys[6],e),tableViewId:e.id,reason:r,daysAgo:0};n.push(i)}if(e.rowKeys.length>10&&1===Math.floor(2*Math.random())){var a={rowKey:e.rowKeys[10],itemId:u.b.getItemIds(e.rowKeys[10],e)[0],conversationId:u.b.getConversationId(e.rowKeys[10],e),tableViewId:e.id,reason:r,daysAgo:3};n.push(a)}}return n}(t))),Object(T.e)().nudgedRows.forEach((function(e){var n=e.rowKey;e.tableViewId!=t.id||d.some((function(t){return t.rowKey===n&&t.tableViewId===e.tableViewId}))||(A(n,t),k(n,"NotReceivedAsNudgeAnyMore",e.reason)),e.tableViewId!=t.id&&d.push(e)})),Object(T.g)(d,t),s.g.info("Nudge: onSelectFolderCompleteOrchestrator new nudges length: "+d.length),U=!1,[2]}}))}))}function B(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var o,a,c,l,f,w,g,I,O,m,v;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,4,,5]),o=e.ItemId.Id,a=e.ConversationId.Id,c=Object(u.L)(t),l=c?a:o,f=void 0,0!==(w=Object(u.A)([l],t)).length?[3,2]:[4,b(l,t)];case 1:return(g=r.sent())?(f=g.InstanceKey,t.rowKeys.indexOf(f)<0&&(I=Object(M.f)(t,0),x.a.addRow(I,g,t)),[3,3]):(s.g.warn("Nudge: Unable to load nudged row for list view type:"+t.tableQuery.listViewType+" itemId: "+o+" conversationId: "+a+" folderId: "+t.tableQuery.folderId),H("RowNotFound",o,a,n,c),[2,null]);case 2:f=w[0],u.b.getIsPinned(f,t)&&H("RowPinned",o,a,n,c),function(e,t){if(1===e.listViewType){var n=Object(L.b)().items.get(t);n&&n.NormalizedBody||d.e.importAndExecute({Id:t,mailboxInfo:Object(i.c)(e)},"LoadNudgedItem")}else Object(L.b)().conversations.get(t)||d.d.importAndExecute({Id:t,mailboxInfo:Object(i.c)(e)},"LoadNudgedConversation")}(t.tableQuery,l),r.label=3;case 3:return O=e.MessageReceivedOrSentTimeUTC||u.b.getLastDeliveryTimeStamp(f,t),m=Object(P.s)(Object(P.mc)(),Object(P.mc)(O)),[2,{rowKey:f,itemId:o,conversationId:a,tableViewId:t.id,reason:N(e.NudgeReason.Reason),daysAgo:m}];case 4:return v=r.sent(),s.g.warn("Nudge: processNudgeResponse throws an exception"+v.message),[2,null];case 5:return[2]}}))}))}function H(e,t,n,r,o){Object(S.o)("Nudge_Discarded",{owa_1:e,owa_2:o,itemId:t,cId:n,crId:r})}var J=n(279),q="FocusedInboxB2/api/v1/Nudges/UpdateNudge";function Y(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){var n,o,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return[4,O()];case 1:return n=r.sent(),o={ItemId:{Id:e},NudgeAction:t},[4,Object(v.d)(q,o,Object(D.a)(),!1,n)];case 2:i=r.sent();try{Object(J.a)(i.status)||s.g.warn("updateNudgesOperation return http status "+i.status)}catch(e){return s.g.info("updateNudgesOperation return error "+e.message),[2,null]}return[2]}}))}))}var W=n(1694),Z=n(3496),$=n(3497),X=n(6244),ee=n(6624),te=n(7712),ne=n(3063),re=Object(V.e)(te.b,"clone_onNudgeInfoBarClicked",(function(e){var t=e.response===te.a.MarkComplete?"MarkedComplete":"DismissedOnView";be(e.rowKey,e.itemId,t,"ReadingPane")})),oe=Object(V.e)(ee.a,"clone_onDismissNudgeClicked",(function(e){Object(T.e)().nudgedRows.filter((function(t){return t.rowKey===e.rowKey&&t.tableViewId===e.tableViewId})).forEach((function(t){be(e.rowKey,t.itemId,"Dismissed",e.actionSource)}))})),ie=Object(V.e)($.a,"clone_markItemsAsPinnedStoreUpdate",(function(e){le(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned)})),ae=Object(V.e)(Z.a,"clone_markConversationsAsPinnedStoreUpdate",(function(e){le(e.rowKeys,e.tableViewId,e.shouldMarkAsPinned)})),de=Object(V.e)(W.a,"clone_deleteItemsStoreUpdate",(function(e){e.itemContexts.map((function(e){return e.itemId})).forEach((function(t){var n=Object(T.d)(t);n&&(Object(T.h)(n),k(n,e.actionType,ge(n)))}))})),se=Object(V.e)(R.a,"clone_removeRowsFromListViewStore",(function(e){we(e.rowKeys,e.tableView.id,e.actionType)})),ue=Object(V.e)(X.a,"clone_onSendMessageSucceeded",(function(e){var t=e.operation;if(1===t||2===t||3===t){e.referenceItemId||s.g.warn("Nudge: referenceItemId should not be null for r/R/f operations");var n=e.referenceItemId.Id,r=e.conversationId,o=Object(T.d)(n);if(o||(o=Object(T.c)(r)),o){A(o,Object(u.C)());var i=ge(o);Object(T.h)(o),Object(S.o)("Nudge_Reply",{owa_1:t,owa_2:i,refId:n,cId:r,rKey:o},{isCore:!0})}}})),ce=Object(V.e)(F.a,"updateNudgesOnNudgeOptionChangeClone",(function(e){if(Object(ne.a)(16)){var t=Object(T.e)().nudgedRows.map((function(e){return e.rowKey})),n=Object(u.C)();t.forEach((function(e){A(e,n),we([e],n.id,"NudgeDisabled")}))}}));function le(e,t,n){var r=n?"Pinned":"Unpinned";e.forEach((function(e){Object(T.e)().nudgedRows.filter((function(n){return n.rowKey===e&&n.tableViewId===t})).forEach((function(e){Y(e.itemId,r),fe(r,"PinUnpin",e.reason,e.itemId)}))})),we(e,t,"PinUnpin")}function be(e,t,n,r){Y(t,n),A(e,Object(u.C)());var o=ge(e);Object(T.h)(e),fe(n,r,o,t)}function fe(e,t,n,r){Object(S.o)("Nudge_Update",{owa_1:e,owa_2:t,owa_3:n,itemId:r},{isCore:!0})}function we(e,t,n){e.forEach((function(e){if(Object(T.f)(e,t)){var r=ge(e);Object(T.h)(e),k(e,n,r)}}))}function ge(e){var t=Object(T.e)().nudgedRows.filter((function(t){return t.rowKey===e}));return t.length>0?t[0].reason:null}var Ie=n(4);function Oe(e,t,n){if(e.tableViewId==t.id){var r,o="Nudge_Render",i=e.rowKey,a=e.conversationId,d=e.itemId;Object(T.a)(i,t.id,u.b.getLastDeliveryOrRenewTimeStamp(i,t))?(r=Object(M.f)(t,0),x.a.updateRowPosition(r,i,t),s.g.info("Nudge: "+n+" updateNudgedRowPosition - row is inserted at "+r)):(o="Nudge_NotRender",s.g.info("Nudge: "+n+" updateNudgedRowPosition - row is pinned")),Object(S.o)(o,{owa_1:n,rKey:i,iId:d,cId:a,index:r},{isCore:!0})}}Object(Ie.orchestrator)(T.g,(function(e){e.nudgedRows.forEach((function(t){return Oe(t,e.tableView,"onGetNudge")}))})),Object(Ie.orchestrator)(M.i,(function(e){var t=Object(T.e)().nudgedRows,n=e.tableView;t.filter((function(e){return e.tableViewId==n.id})).forEach((function(t){return Oe(t,e.tableView,"onMerge")}))})),n.d(t,"getNudgesOnSelectFolderComplete",(function(){return G})),n.d(t,"getNudgesOnNudgeOptionChange",(function(){return Q})),n.d(t,"removeNudgeOnInfoBarClickedOrchestrator",(function(){return re})),n.d(t,"removeNudgeOnDismissNudgeClickedOrchestrator",(function(){return oe})),n.d(t,"removeNudgeOnItemDeleteStoreUpdateOrchestrator",(function(){return de})),n.d(t,"removeNudgeOnRowsDeleteStoreUpdateOrchestrator",(function(){return se})),n.d(t,"removeNudgeOnItemsPinnedStoreUpdateOrchestrator",(function(){return ie})),n.d(t,"removeNudgeOnConversationsPinnedStoreUpdateOrchestrator",(function(){return ae})),n.d(t,"removeNudgeOnReplyOrReplyAllOrForwardOrchestrator",(function(){return ue})),n.d(t,"updateNudgesOnNudgeOptionChange",(function(){return ce}))},241:function(e,t,n){"use strict";function r(){var e=Object.create(null),t=0,n=0,r=0,o=!1;function i(t){r--,delete e[t]}this.put=function(t,n,o,a){if(void 0!==o&&("number"!=typeof o||isNaN(o)||o<=0))throw new Error("Cache timeout must be a positive number");if(void 0!==a&&"function"!=typeof a)throw new Error("Cache timeout callback must be a function");var d=e[t];d?clearTimeout(d.timeout):r++;var s={value:n,expire:o+Date.now()};return isNaN(s.expire)||(s.timeout=setTimeout(function(){i(t),a&&a(t,n)}.bind(this),o)),e[t]=s,n},this.del=function(t){var n=!0,r=e[t];return r?(clearTimeout(r.timeout),!isNaN(r.expire)&&r.expire<Date.now()&&(n=!1)):n=!1,n&&i(t),n},this.clear=function(){for(var i in e)clearTimeout(e[i].timeout);r=0,e=Object.create(null),o&&(t=0,n=0)},this.get=function(i){var a=e[i];if(void 0!==a){if(isNaN(a.expire)||a.expire>=Date.now())return o&&t++,a.value;o&&n++,r--,delete e[i]}else o&&n++;return null},this.size=function(){return r},this.memsize=function(){var t,n=0;for(t in e)n++;return n},this.debug=function(e){o=e},this.hits=function(){return t},this.misses=function(){return n},this.keys=function(){return Object.keys(e)},this.exportJson=function(){var t={};for(var n in e){var r=e[n];t[n]={value:r.value,expire:r.expire||"NaN"}}return JSON.stringify(t)},this.importJson=function(t,n){var r=JSON.parse(t),o=Date.now(),i=n&&n.skipDuplicates;for(var a in r)if(r.hasOwnProperty(a)){if(i)if(e[a])continue;var d=r[a],s=d.expire-o;if(s<=0){this.del(a);continue}s=s>0?s:void 0,this.put(a,d.value,s)}return this.size()}}e.exports=new r,e.exports.Cache=r},9028:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(1186),o=n(1386);function i(e,t){var n=e[e.length-1],i=t.rowKeys.indexOf(n);i<t.rowKeys.length-1?Object(r.r)(t,t.rowKeys[i+1],!1,o.a.RowRemoval):Object(r.j)(t,o.a.Reset)}}}]);
//# sourceMappingURL=owa.911.js.map
self.scriptsLoaded['owa.911.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.911.js'] = (new Date()).getTime();