self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.Translation.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[592],{2628:function(e,t,n){"use strict";var a=n(4),r=n(428);t.a=Object(a.createStore)("TranslationStore",{sessionId:Object(r.a)(),localeOfSupportedLanguageMap:null,supportedLanguageMap:null,isUserLocaleSupported:!1,userLanguageName:null,userLanguageTag:null,settings:{translationMode:null,targetLanguage:null,excludedLanguages:null,initialized:!1}})()},9850:function(e,t,n){"use strict";n.r(t);var a,r=n(0),s=n(2628),u=n(27),i=n(287),o="/ows/beta/OutlookCloudSettings/settings/account",g="translator_translation_mode",c="translator_target_language",l="translator_known_languages";function d(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){return a||(a=Object(i.b)(o+"?settingname=\n            "+g+",\n            "+c+",\n            "+l,null,!1,null,!0).then((function(e){var t={translationMode:null,targetLanguage:null,excludedLanguages:null,initialized:!1};return e.forEach((function(e){switch(e.name){case g:t.translationMode=parseInt(e.value,10);break;case c:t.targetLanguage=e.value;break;case l:var n=JSON.parse(e.value);t.excludedLanguages=[],n.forEach((function(e){return t.excludedLanguages.push(e.languageTag)}))}})),t})).catch((function(e){throw a=null,e}))),[2,a]}))}))}function f(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){return[2,Object(i.c)(o,e,null,!0,{Accept:"application/json","x-overridetimestamp":!0})]}))}))}var p=n(4),L=Object(p.mutatorAction)("setTranslationSettings",(function(e){s.a.settings.translationMode=e.translationMode,s.a.settings.targetLanguage=e.targetLanguage,s.a.settings.excludedLanguages=e.excludedLanguages,s.a.settings.initialized=!0})),h=n(76),O=n(960);function v(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return(t=Object(O.d)(O.a.Translation)).translationMode=Object(h.h)("tra-useOcsSettings")?e.translationMode+16:e.translationMode,t.targetLanguage=e.targetLanguage,t.excludedLanguages=e.excludedLanguages,[4,O.e.importAndExecute(O.a.Translation,t)];case 1:return n.sent(),[2]}}))}))}var b=n(279),S=n(254);function j(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,a,i,o,g,c;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(t=[],n=Object(u.a)().SessionSettings.UserEmailAddress,s.a.settings.translationMode!==e.translationMode&&(M(t,e.translationMode,n),Object(S.o)("InlineTranslationChangeTranslationMode",[],{cosmosOnlyData:e.translationMode.toString()})),s.a.settings.targetLanguage!==e.targetLanguage&&(_(t,e.targetLanguage,n),Object(S.o)("InlineTranslationChangeTargetLanguage",[],{cosmosOnlyData:e.targetLanguage?e.targetLanguage:"none"})),a=!1,e.excludedLanguages.forEach((function(e){s.a.settings.excludedLanguages.includes(e)||(a=!0,Object(S.o)("InlineTranslationOptOutOfLanguage",[],{cosmosOnlyData:e}))})),s.a.settings.excludedLanguages.forEach((function(t){e.excludedLanguages.includes(t)||(a=!0,Object(S.o)("InlineTranslationRemoveOptOutOfLanguage",[],{cosmosOnlyData:t}))})),a&&w(t,e.excludedLanguages,n),!(t.length>0))return[3,7];i="SavingOcsSettings",r.label=1;case 1:return r.trys.push([1,5,,6]),Object(h.h)("tra-useOcsSettings")?[4,f(t)]:[3,3];case 2:if(!(o=r.sent())||!Object(b.a)(o.status))throw new Error("Failed to save settings in OCS");r.label=3;case 3:return i="SavingOoSettings",[4,v(e)];case 4:return r.sent(),[3,6];case 5:return g=r.sent(),c=g instanceof Error?g:new Error("Error while "+i),new S.a("InlineTranslationUpdateSettings").endWithError("ServerError",c),[2,!1];case 6:L(e),r.label=7;case 7:return[2,!0]}}))}))}function M(e,t,n){e.push({name:g,value:t,type:"Int",scope:n})}function _(e,t,n){var a=null==t?"":t;e.push({name:c,value:a,type:"String",scope:n})}function w(e,t,n){var a=[];t.forEach((function(e){return a.push({languageTag:e})})),e.push({name:l,value:JSON.stringify(a),type:"JSON",scope:n})}function m(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return s.a.settings.excludedLanguages&&e&&!s.a.settings.excludedLanguages.includes(e)?((t={translationMode:s.a.settings.translationMode,targetLanguage:s.a.settings.targetLanguage,excludedLanguages:Object(r.__spread)(s.a.settings.excludedLanguages),initialized:!0}).excludedLanguages.push(e),[4,j(t)]):[2];case 1:return n.sent(),[2]}}))}))}var x="-",T=4;function A(e){if(0===(e=e.toLowerCase()).lastIndexOf("zh-",0))switch(e){case"zh-cht":case"zh-hant":case"zh-hk":case"zh-tw":return"zh-cht";default:return"zh-chs"}var t=e.indexOf(x,1);if(-1===t)return e;var n=e.indexOf(x,t+x.length);return-1===n&&(n=e.length),n-t==x.length+T&&(t=n),e.substring(0,t)}function E(e){return!(!s.a.supportedLanguageMap||!e)&&s.a.supportedLanguageMap.has(e)}function y(e,t){void 0===t&&(t=null);var n=A(e);if(!E(n))return!1;if(null!=t){var a=A(t);return!!E(a)&&n!==a}return!0}var G=n(4507);var z="https://ogma.osi.office.net",I="/TradukoApi/api/v1.0/translateContentArray",N="/TradukoApi/api/v1.0/supportedLanguages",R="/TradukoApi/api/v1.0/detectLanguage",q="ows/api/v1/translation/translateText",U="ows/api/v1/translation/getSupportedLanguages";function H(e){return U+"?clientLocale="+e}var D=n(2),k=s.a.sessionId,W=Object(D.i)(),C=Object(D.j)();function J(e,t){return!!(t&&k&&W&&C)&&(e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("Accept","application/json, text/plain, */*"),e.setRequestHeader("x-translator-sid",k),e.setRequestHeader("x-translator-cross-sid",k),e.setRequestHeader("x-translator-cid",t),e.setRequestHeader("x-translator-user-id",W),e.setRequestHeader("x-translator-client-version",C),e.setRequestHeader("x-translator-client-app","Outlook"),e.setRequestHeader("x-translator-client-type","Browser"),!0)}var P=n(103),F=s.a.sessionId,X=Object(P.i)().SessionSettings.UserPuid,$=Object(D.j)();function B(e){if(e&&F&&X&&$)return{"x-translator-sid":F,"x-translator-cross-sid":F,"x-translator-cid":e,"x-translator-user-id":X,"x-translator-client-version":$}}var K=3e4;function Q(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,new Promise((function(n,a){Object(h.h)("rp-inlineTranslation-UseOWS")?function(e,t,n,a){Object(r.__awaiter)(this,void 0,void 0,(function(){var s,u,o,g,c,l,d,f;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(s=B(t)))return[3,5];u=A(e),o=!1,g=setTimeout((function(){o=!0,a("Request timed out")}),K),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Object(i.b)(H(u),t,!1,s,!0)];case 2:return c=r.sent(),o||(clearTimeout(g),(l=V(c))?n(l):a("OWS OGMA returned invalid response: "+c)),[3,4];case 3:return d=r.sent(),f=(null==d?void 0:d.message)?d.message:"",a("getSupportedLanguagesOWS failed:"+f),[3,4];case 4:return[3,6];case 5:a("getSupportedLanguagesOWS failed: headers were not set."),r.label=6;case 6:return[2]}}))}))}(e,t,n,a):function(e,t,n,a){var r=new XMLHttpRequest;r.timeout=K,r.onload=function(){if(200===r.status)if(this.responseText){var e=V(JSON.parse(this.responseText));e?n(e):a("OGMA returned invalid response: "+this.response)}else a("OGMA returned invalid response: "+this.response);else a("OGMA failed to retrieve supported languages: "+this.response)},r.onerror=function(){a("OGMA call failed: "+this.response)},r.ontimeout=function(){a("OGMA call timed out")};var s=A(e);r.open("GET",function(e){return""+z+N+"?clientLocale="+e}(s)),J(r,t)?r.send():a("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,n,a)}))]}))}))}function V(e){try{var t=new Map;return e.forEach((function(e){t.set(e.LanguageTag,e)})),t}catch(e){return null}}function Y(e,t){if(e.length!=t.length)return!0;for(var n=0;n<e.length;n++)if(!t.includes(e[n]))return!0;return!1}var Z=Object(p.mutatorAction)("setSupportedLanguageMap",(function(e,t){var n=A(e),a=t.get(n);a?(s.a.localeOfSupportedLanguageMap=e,s.a.userLanguageName=a.LanguageName,s.a.userLanguageTag=n,s.a.supportedLanguageMap=t,s.a.isUserLocaleSupported=y(e)):s.a.isUserLocaleSupported=!1})),ee=n(428),te=15e3,ne=0,ae=te;function re(){return Object(r.__awaiter)(this,void 0,void 0,(function(){var e,t,n,a,i,o,g,c,l,p,b;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(e=Object(u.a)().SessionSettings.UserCulture,t=Date.now(),Object(h.h)("rp-inlineTranslationAutomatic")||s.a.settings.translationMode!==G.a.Automatic||(s.a.settings.translationMode=G.a.Suggest),!Object(h.h)("rp-inlineTranslation-targetLanguage")&&s.a.settings.targetLanguage&&(s.a.settings.targetLanguage=""),e===s.a.localeOfSupportedLanguageMap&&s.a.settings.initialized||!(0===ne||t>ne+ae))return[3,11];n=null,a=Object(ee.a)(),i=new S.a("InlineTranslationGetSupportedLanguages"),r.label=1;case 1:return r.trys.push([1,9,,10]),null!=s.a.supportedLanguageMap?[3,3]:[4,Q(e,a)];case 2:n=r.sent(),Z(e,n),E(s.a.settings.targetLanguage)||(s.a.settings.targetLanguage=""),r.label=3;case 3:return s.a.settings.initialized?[3,8]:[4,O.f.import()];case 4:return[4,r.sent()(O.a.Translation)];case 5:return o=r.sent(),g=function(e){if(e.translationMode>G.a.Suggest)return e.translationMode=e.translationMode-16,(e.translationMode<G.a.SuggestAutomatic||e.translationMode>G.a.Suggest)&&(e.translationMode=G.a.SuggestAutomatic),!1;return!0}(o),c={translationMode:o.translationMode,targetLanguage:null!=o.targetLanguage?o.targetLanguage:"",excludedLanguages:o.excludedLanguages,initialized:!1},Object(h.h)("tra-useOcsSettings")?[4,d()]:[3,7];case 6:l=r.sent(),function(e,t,n){var a=!1,r=[],s=Object(u.a)().SessionSettings.UserEmailAddress;null==t.translationMode||n&&t.translationMode!==e.translationMode?M(r,e.translationMode,s):t.translationMode!==e.translationMode&&(e.translationMode=t.translationMode,a=!0),null==t.targetLanguage||n&&t.targetLanguage!==e.targetLanguage?_(r,e.targetLanguage,s):t.targetLanguage!==e.targetLanguage&&(e.targetLanguage=t.targetLanguage,a=!0),null==t.excludedLanguages||n&&Y(e.excludedLanguages,t.excludedLanguages)?w(r,e.excludedLanguages,s):Y(e.excludedLanguages,t.excludedLanguages)&&(e.excludedLanguages=t.excludedLanguages,a=!0),r.length>0&&f(r),(a||n)&&v(e)}(c,l,g),r.label=7;case 7:L(c),r.label=8;case 8:return ne=0,ae=te,i.end(),[3,10];case 9:throw p=r.sent(),b=new Error("[InlineTranslation] Failed to initialize translation. Error:"+p+" | cid:"+a),ne=t,ae*=2,i.endWithError("ServerError",b),p;case 10:return[2,!0];case 11:return[2,!1]}}))}))}function se(){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(e){switch(e.label){case 0:return[4,re()];case 1:return e.sent(),[2,s.a.supportedLanguageMap]}}))}))}function ue(){return s.a.localeOfSupportedLanguageMap}function ie(e,t){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(n){return[2,new Promise((function(n,a){var r=new XMLHttpRequest;r.onload=function(){if(200===r.status){var e=JSON.parse(this.responseText);e?n(e):a("OGMA returned invalid response: "+this.response)}else a("OGMA failed to detect email language: "+this.response)},r.onerror=function(){a("OGMA call failed: "+this.response)},r.open("POST",""+z+R),J(r,t)?r.send(JSON.stringify(e)):a("getOgmaDetectedLanguage failed: headers were not set. ")}))]}))}))}var oe=1e4;function ge(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t,n,a,s,u,i;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:t=Object(ee.a)(),n=null,a=new S.a("InlineTranslationGetDetectedLanguage"),r.label=1;case 1:return r.trys.push([1,3,,4]),(s=e.join(" ")).length>oe&&(s=s.substring(0,oe)),[4,ie(s,t)];case 2:return n=r.sent(),a.end(),[3,4];case 3:return u=r.sent(),i=new Error("[InlineTranslation] getOgmaDetectedLanguage failed. Error:"+u+" | cid:"+t),a.endWithError("ServerError",i),[3,4];case 4:return[2,n]}}))}))}function ce(e){return s.a.supportedLanguageMap.has(e)?s.a.supportedLanguageMap.get(e).LanguageName:null}function le(){return s.a.userLanguageName}function de(){return s.a.userLanguageTag}function fe(){return s.a.settings.targetLanguage?ce(s.a.settings.targetLanguage):le()}function pe(){return s.a.settings.targetLanguage?s.a.settings.targetLanguage:s.a.userLanguageTag}function Le(){return s.a.settings}function he(){return s.a.isUserLocaleSupported}var Oe=3e4;function ve(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(a){return[2,new Promise((function(a,s){Object(h.h)("rp-inlineTranslation-UseOWS")?function(e,t,n,a,s){Object(r.__awaiter)(this,void 0,void 0,(function(){var u,o,g,c,l;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:if(!(u=B(n)))return[3,5];o=!1,g=setTimeout((function(){o=!0,s("Request timed out")}),Oe),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,Object(i.d)((d=t,q+"?toLang="+d),e,n,!1,u,!0)];case 2:return c=r.sent(),o||(clearTimeout(g),null!=c?a(be(c)):s("OGMA returned invalid response: "+c)),[3,4];case 3:return l=r.sent(),s("translateTextOWS failed:"+l.message),[3,4];case 4:return[3,6];case 5:s("translateTextOWS failed: headers were not set."),r.label=6;case 6:return[2]}var d}))}))}(e,t,n,a,s):function(e,t,n,a,r){var s=new XMLHttpRequest;s.timeout=Oe,s.onload=function(){if(200===s.status){var e=JSON.parse(this.responseText);null!=e?a(be(e)):r("OGMA returned invalid response: "+this.response)}else r("OGMA failed to translate messaage: "+this.response)},s.onerror=function(){r("OGMA call failed: "+this.response)},s.ontimeout=function(){r("OGMA call timed out")},s.open("POST",function(e){return""+z+I+"?fromLang=&toLang="+e}(t)),J(s,n)?s.send(function(e){var t=[];return e.forEach((function(e){var n={Data:e,DataType:"html"};t.push(n)})),JSON.stringify(t)}(e)):r("getSupportedLanguagesOgma failed: headers were not set. ")}(e,t,n,a,s)}))]}))}))}function be(e){var t=[];return e.forEach((function(e){t.push(e.TranslatedText)})),t}function Se(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){return Object(r.__generator)(this,(function(t){switch(t.label){case 0:return[4,j({translationMode:e,targetLanguage:s.a.settings.targetLanguage,excludedLanguages:Object(r.__spread)(s.a.settings.excludedLanguages),initialized:!0})];case 1:return t.sent(),[2]}}))}))}n.d(t,"addExcludedLanguage",(function(){return m})),n.d(t,"checkCanTranslate",(function(){return y})),n.d(t,"initSupportedLanguages",(function(){return re})),n.d(t,"initAndGetSupportedLanguageMap",(function(){return se})),n.d(t,"getLocaleOfSupportedLanguageMap",(function(){return ue})),n.d(t,"getOgmaSupportedLanguageTag",(function(){return A})),n.d(t,"getDetectedLanguage",(function(){return ge})),n.d(t,"getLanguageNameFromTag",(function(){return ce})),n.d(t,"getUserLanguageName",(function(){return le})),n.d(t,"getUserLanguageTag",(function(){return de})),n.d(t,"getTargetLanguageName",(function(){return fe})),n.d(t,"getTargetLanguageTag",(function(){return pe})),n.d(t,"getTranslationSettings",(function(){return Le})),n.d(t,"getIsUserLocaleSupported",(function(){return he})),n.d(t,"translateText",(function(){return ve})),n.d(t,"updateTranslationMode",(function(){return Se})),n.d(t,"updateTranslationSettings",(function(){return j}))}}]);
//# sourceMappingURL=owa.Translation.js.map
self.scriptsLoaded['owa.Translation.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.Translation.js'] = (new Date()).getTime();