self.scriptsLoaded = self.scriptsLoaded || {}; self.scriptProcessStart = self.scriptProcessStart || {}; self.scriptProcessStart['owa.SharePointLink.js'] = (new Date()).getTime();(window.$wj=window.$wj||[]).push([[536],{1011:function(e,t,n){"use strict";function r(e){return t=e||"",(n=i.exec(t))&&n.length>1&&c[n[1].toLowerCase()];var t,n}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var c={"image/bmp":".bmp","image/x-ms-bmp":".bmp","image/gif":".gif","image/jpeg":".jpeg","image/png":".png","image/vnd.adobe.photoshop":".psd","image/tiff":".tiff"},i=/^\s*([^;\s]*)(?:;|\s|$)/;function a(e){var t="";return Object.entries(c).forEach((function(n){n[1]===e&&(t=n[0])})),t}},1091:function(e,t,n){"use strict";n.d(t,"a",(function(){return u})),n.d(t,"b",(function(){return s}));var r=n(972),c=n(1011),i=n(60),a=[".bmp",".gif",".jpe",".jpeg",".jpg",".jfif",".dib",".png",".psd"],o=[".tiff",".tif"];function u(e,t,n){return void 0===n&&(n=!0),s(Object(r.a)(e)||Object(c.a)(t),n)}function s(e,t){return void 0===t&&(t=!0),!!e&&(a.indexOf(e.toLowerCase())>=0||t&&o.indexOf(e.toLowerCase())>=0&&(Object(i.e)()||Object(i.d)()||Object(i.h)()||Object(i.g)()&&!Object(i.l)()))}},1296:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(0);function c(e){return Object(r.__assign)({__type:"FetchDataProviderResourceRequest:#Exchange"},e)}},1328:function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return o}));var r="originalsrc",c="shash",i="data-auth",a="&reserved=0",o="Verified"},1361:function(e){e.exports=JSON.parse('{"b":"Pca","d":"Qca","c":"Rca","a":"Sca"}')},1605:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(25),c=n(1296);function i(e,t){return void 0===e||e.__type||(e=Object(c.a)(e)),Object(r.a)("FetchDataProviderResource",e,t)}},1946:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return a})),n.d(t,"e",(function(){return o})),n.d(t,"f",(function(){return u})),n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return f}));var r=n(108),c=new r.c((function(){return n.e(537).then(n.bind(null,3111))})),i=new r.b(c,(function(e){return e.extractFileUrlFromOfficeSharePointLink})),a=new r.b(c,(function(e){return e.isLinkPrefixedWithBaseUrl})),o=new r.b(c,(function(e){return e.isSharePointLink})),u=new r.b(c,(function(e){return e.isSharePointServiceGeneratedLink})),s=new r.b(c,(function(e){return e.isOfficeSharePointLink})),f=new r.b(c,(function(e){return e.getParsedQueryStringFromUrl}))},2390:function(e,t,n){"use strict";n.d(t,"f",(function(){return a})),n.d(t,"g",(function(){return o}));var r=n(108),c=n(1328);n.d(t,"b",(function(){return c.b})),n.d(t,"d",(function(){return c.d})),n.d(t,"a",(function(){return c.a})),n.d(t,"c",(function(){return c.c})),n.d(t,"e",(function(){return c.e}));var i=new r.c((function(){return n.e(252).then(n.bind(null,4129))})),a=new r.b(i,(function(e){return e.evaluateSafeLink})),o=(new r.b(i,(function(e){return e.evaluateSafeLinks})),new r.b(i,(function(e){return e.isSafeLink})))},3527:function(e,t,n){"use strict";n.d(t,"a",(function(){return u}));var r=n(0),c=n(254),i=n(1296),a=n(1605),o=n(79);function u(e,t,n,u,s){return Object(r.__awaiter)(this,void 0,void 0,(function(){var f,d,l,b,p,O,v,h,j,w,m,S,g,k;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:f=new c.a("getWacInfoForOneDriveJsApi",{isCore:!0}),u&&f.addCustomData({redeemSharingLinkIfNecessary:u}),r.label=1;case 1:return r.trys.push([1,3,,4]),d=btoa(t),l="u!"+d.replace(/^\=+|\=+$/g,"").replace("/","_").replace("+","-"),b=new RegExp(/.+?\:\/\/.+?(\/)/g).exec(t)[0],p=b+"_api/v2.0/shares/"+l+"/root?select=openWith/wac,officeBundle,@content.downloadUrl,name,size,currentUserRole&action="+(n?"Open":"View"),O=new Object,u&&(O.prefer="redeemSharingLinkIfNecessary"),v=Object(i.a)({ProviderType:e,Url:p,Headers:JSON.stringify(O)}),h=(new Date).getTime(),[4,Object(a.a)(v)];case 2:if(200===(j=r.sent()).Status&&j.Body)return w=(new Date).getTime(),(m=JSON.parse(j.Body)).fetchStartTime=h,m.responseStartTime=w,!m.openWith.wac&&s||(m.openWith.wac.fileGetUrl=m["@content.downloadUrl"],m.openWith.wac.accessTokenExpiry&&(m.openWith.wac.accessTokenExpiry=new Date(Number(m.openWith.wac.accessTokenExpiry))),!n&&m.currentUserRole&&(m.currentUserRole.readOnly=!0)),f.end(),[2,m];throw f.addCustomData({StatusCode:j.Status}),(S=j.Headers)&&(g=JSON.parse(S))&&f.addCustomData({SharePointError:g.SharePointError,SPClientServiceRequestDuration:g.SPClientServiceRequestDuration,SPRequestGuid:g.SPRequestGuid}),new Error("Result status is: "+j.Status+" or empty response body.");case 3:return k=r.sent(),f.endWithError("ServerError",k),o.g.warn("Something went wrong while calling fetchDataProviderResourceOperation: "+k),[3,4];case 4:return[2,null]}}))}))}},3845:function(e,t,n){"use strict";n.r(t);var r=n(3961),c=n(4697),i=n(4);Object(i.mutator)(r.f,(function(e){var t=e.url;c.a.activeGetWacInfoOperations.push(t)})),Object(i.mutator)(r.d,(function(e){var t=e.url;c.a.activeGetWacInfoOperations.splice(c.a.activeGetWacInfoOperations.indexOf(t),1)})),Object(i.mutator)(r.e,(function(e){var t=e.url,n=e.wacUrlInfo,r=e.needRedeem,i={time:Date.now(),wacUrlInfo:n,needRedeem:r};c.a.docLinkPreviewInfoMap.set(t,i)})),Object(i.mutator)(r.i,(function(e){var t=e.url;c.a.getWacInfoQueue.push(t)})),Object(i.mutator)(r.c,(function(){c.a.getWacInfoQueue.shift()})),Object(i.mutator)(r.h,(function(e){var t=e.url;c.a.suppressedUrls.push(t)}));var a=n(5377),o=n(9e3),u=n(9001);Object(i.orchestrator)(r.a,(function(e){var t=e.element,n=e.isSafeLinkWrapped,r=e.isSafeLinkVerified,c=function(e){Object(u.a)(e,n,r,null)};t.addEventListener("click",c),t[a.a]=c;var i=function(e){Object(o.a)(e,n,r)};t.addEventListener("mouseup",i),t[a.b]=i}));var s=n(0),f=n(7222);Object(i.orchestrator)(r.g,(function(){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var e;return Object(s.__generator)(this,(function(t){switch(t.label){case 0:if(!c.a.getWacInfoQueue.length)return[2];if(c.a.activeGetWacInfoOperations.length>=a.d)return[2];e=c.a.getWacInfoQueue[0],Object(r.f)(e),Object(r.c)(),t.label=1;case 1:return t.trys.push([1,,3,4]),[4,Object(f.a)(e,!1)];case 2:return t.sent(),[3,4];case 3:return Object(r.d)(e),Object(r.g)(),[7];case 4:return[2]}}))}))}));var d=n(254),l=n(76),b=n(2390),p=n(1946),O=n(1801),v=[/unsubscribealert\.aspx/i];var h=function(e){for(var t=0;t<v.length;t++){if(v[t].test(e))return!1}return!0};Object(i.orchestrator)(O.b,(function(e){return Object(s.__awaiter)(void 0,void 0,void 0,(function(){var t,n,c,i,a,o,u,f,d,O,v,j,m,S,g,k,I;return Object(s.__generator)(this,(function(s){switch(s.label){case 0:return t=e.element,n=e.itemId,c=e.sxsId,"a"!==t.tagName.toLowerCase()?[3,20]:(i=t,[4,p.e.import()]);case 1:return a=s.sent(),[4,p.f.import()];case 2:return o=s.sent(),[4,b.g.import()];case 3:return u=s.sent(),[4,p.d.import()];case 4:return f=s.sent(),[4,b.f.import()];case 5:return d=s.sent(),[4,u(i)];case 6:return s.sent()?(m=t.getAttribute(b.b),g=t.getAttribute(b.a)===b.e,O=i.href,S=!0,a(m)?h(m)?(v=void 0,o(m)?(Object(r.a)(t,S,g),[3,11]):[3,7]):[3,11]:[3,12]):[3,17];case 7:return Object(l.h)("doc-SxS-jsApi-ODB-Links")&&g?(Object(r.b)(t,m,n,S,g,!1,c),[3,11]):[3,8];case 8:return(j=Object(l.h)("doc-SxS-jsApi-ODB-Links")&&!g)?[4,d(O)]:[3,10];case 9:j=!!(v=s.sent()),s.label=10;case 10:j?Object(r.b)(t,v,n,S,g,!1,c):Object(r.a)(t,S,g),s.label=11;case 11:return w(),[3,16];case 12:return f(m)&&Object(l.h)("doc-link-office")?g?[3,14]:[4,d(O)]:[3,16];case 13:m=s.sent(),s.label=14;case 14:return[4,p.a.import()];case 15:k=s.sent(),(I=k(m))&&Object(r.b)(t,I,n,S,g,!0,c),s.label=16;case 16:return[3,20];case 17:return m=i.href,S=!1,g=!1,a(m)?(h(m)&&(o(m)?Object(r.a)(t,S,g):Object(l.h)("doc-SxS-jsApi-ODB-Links")?Object(r.b)(t,m,n,S,g,!1,c):Object(r.a)(t,S,g)),w(),[3,20]):[3,18];case 18:return f(m)&&Object(l.h)("doc-link-office")?[4,p.a.import()]:[3,20];case 19:k=s.sent(),(I=k(m))&&Object(r.b)(t,I,n,S,g,!0,c),s.label=20;case 20:return[2]}}))}))}));var j=!1;function w(){j||(j=!0,Object(d.o)("SharePointLinkFound"))}var m=n(5873);function S(e){var t=c.a.docLinkPreviewInfoMap.get(e),n=!!t;return(!t||t.time+a.c<=Date.now())&&Object(r.j)(e),n}Object(i.orchestrator)(r.j,(function(e){var t=e.url;c.a.getWacInfoQueue.some((function(e){return e===t}))||c.a.activeGetWacInfoOperations.some((function(e){return e===t}))||c.a.suppressedUrls.some((function(e){return e===t}))||Object(m.a)(t)||(Object(r.i)(t),Object(r.g)())})),Object(i.orchestrator)(O.c,(function(e){var t=e.elements;t&&t.forEach((function(e){var t=e[a.a];t&&(e.removeEventListener("click",t),e[a.a]=null);var n=e[a.b];n&&(e.removeEventListener("mouseup",n),e[a.b]=null)}))})),n.d(t,"tryProcessSharePointLink",(function(){return O.b})),n.d(t,"tryUndoProcessSharePointLink",(function(){return O.c})),n.d(t,"docLinkHadPreviewInfo",(function(){return S})),n.d(t,"forceGetWacInfoOperation",(function(){return f.a})),n.d(t,"getValidDocLinkPreviewInfo",(function(){return m.a}))},3857:function(e,t,n){"use strict";var r=n(25),c=n(0);function i(e,t){var n;return void 0===e.request||e.request.__type||(e.request=(n=e.request,Object(c.__assign)({__type:"GetWacInfoRequest:#Exchange"},n))),Object(r.a)("GetWacInfo",e,t)}function a(e,t,n,r,c){return void 0===n&&(n=!1),void 0===r&&(r=!1),i({request:{Url:e,IsEdit:r,ProviderType:t,ShouldGrantAccess:n}},c)}n.d(t,"a",(function(){return a}))},3961:function(e,t,n){"use strict";n.d(t,"j",(function(){return c})),n.d(t,"i",(function(){return i})),n.d(t,"g",(function(){return a})),n.d(t,"c",(function(){return o})),n.d(t,"f",(function(){return u})),n.d(t,"d",(function(){return s})),n.d(t,"h",(function(){return f})),n.d(t,"e",(function(){return d})),n.d(t,"a",(function(){return l})),n.d(t,"b",(function(){return b}));var r=n(4),c=Object(r.action)("tryQueueGetWacInfo",(function(e){return{url:e}})),i=Object(r.action)("queueGetWacInfo",(function(e){return{url:e}})),a=Object(r.action)("processGetWacInfoQueue"),o=Object(r.action)("getWacInfoQueueShift"),u=Object(r.action)("onStartGetWacInfoOperation",(function(e){return{url:e}})),s=Object(r.action)("onFinishGetWacInfoOperation",(function(e){return{url:e}})),f=Object(r.action)("pushSupressedUrl",(function(e){return{url:e}})),d=Object(r.action)("onGetWacInfoSuccess",(function(e,t,n){return{url:e,wacUrlInfo:t,needRedeem:n}})),l=Object(r.action)("addGenericLinkClickListener",(function(e,t,n){return{element:e,isSafeLinkWrapped:t,isSafeLinkVerified:n}})),b=Object(r.action)("addOpenDocumentPreviewEventListener",(function(e,t,n,r,c,i,a){return{element:e,href:t,itemId:n,isSafeLinkWrapped:r,isSafeLinkVerified:c,isOfficeSPLink:i,sxsId:a}}))},4697:function(e,t,n){"use strict";var r=n(24),c=n(4),i={activeGetWacInfoOperations:[],getWacInfoQueue:[],suppressedUrls:[],docLinkPreviewInfoMap:new r.ObservableMap},a=Object(c.createStore)("sharePointDocLinkPreview",i);t.a=a()},5377:function(e,t,n){"use strict";n.d(t,"c",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var r=18e5,c=2,i="SP_LINK_CLICK_EVENT_LISTENER",a="SP_LINK_MOUSEUP_EVENT_LISTENER"},5873:function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return a}));var r=n(5377),c=n(4697);function i(e){return a(e).docLinkPreviewInfo||null}function a(e){var t=c.a.docLinkPreviewInfoMap.get(e);return t?t.time+r.c>Date.now()?{docLinkPreviewInfo:t}:{reason:"Expired"}:c.a.getWacInfoQueue.some((function(t){return t===e}))||c.a.activeGetWacInfoOperations.some((function(t){return t===e}))?{reason:"InQueue"}:c.a.suppressedUrls.some((function(t){return t===e}))?{reason:"FileTypeNotSupportedOrSuppressedAfterError"}:{reason:"Unknown"}}},6328:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(254);function c(e,t,n,c,i){Object(r.o)("SharePointLinkClick",{newTabReason:e,isSafeLinkWrapped:t,isSafeLinkVerified:n,extraInfo:c,isOfficeSPLink:i})}},7222:function(e,t,n){"use strict";n.d(t,"a",(function(){return f}));var r=n(0),c=n(3857),i=n(3527),a=n(76),o=n(966),u=n(3961),s=n(5873);function f(e,t,n){return Object(r.__awaiter)(this,void 0,void 0,(function(){var c,f,l,b;return Object(r.__generator)(this,(function(r){switch(r.label){case 0:return r.trys.push([0,,9,10]),Object(u.f)(e),c=null,Object(a.h)("doc-SxS-jsApi-ODB-Links")?[4,Object(i.a)(0,e,!0,n,!0)]:[3,6];case 1:return(f=r.sent())?[3,2]:(Object(u.h)(e),[2,null]);case 2:return l=Object(o.b)(f.name),(b=Object(o.f)(l))!==o.a.Word&&b!==o.a.Excel&&b!==o.a.PowerPoint?[3,3]:(f.openWith.wac?c={wacUrl:f.openWith.wac.applicationUrl,jsApiInfo:{bootScriptUrl:f.openWith.wac.bootstrapperUrl,wopiSrcUrl:f.openWith.wac.wopiSrc,accessToken:f.openWith.wac.accessToken,accessTokenExpiry:f.openWith.wac.accessTokenExpiry,fileSize:f.size,fileGetUrl:f.openWith.wac.fileGetUrl,bundleInfo:f.officeBundle,fetchStartTime:f.fetchStartTime,responseStartTime:f.responseStartTime,openUrl:e,fileName:f.name,userId:f.openWith.wac.userId,clientThrottlingProtection:f.openWith.wac.clientThrottlingProtection,requestedCallThrottling:f.openWith.wac.requestedCallThrottling},readOnly:f.currentUserRole.readOnly}:Object(u.e)(e,null,!0),[3,5]);case 3:return[4,d(e)];case 4:c=r.sent(),r.label=5;case 5:return[3,8];case 6:return[4,d(e)];case 7:c=r.sent(),r.label=8;case 8:return c&&Object(u.e)(e,c),t?[2,Object(s.a)(e)]:[2,null];case 9:return Object(u.d)(e),[7];case 10:return[2]}}))}))}function d(e){return Object(r.__awaiter)(this,void 0,void 0,(function(){var t;return Object(r.__generator)(this,(function(n){switch(n.label){case 0:return[4,Object(c.a)(e,0)];case 1:if(9===(t=n.sent()).Status||6===t.Status||5===t.Status)Object(u.h)(e);else if(0===t.Status)return[2,{wacUrl:t.WacUrl,bootScriptUrl:t.BootScriptUrl,wopiSrcUrl:t.WopiSrcUrl,accessToken:t.AccessToken,deprecatedTokenAndParameters:t.Token}];return[2,null]}}))}))}},9e3:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(6328),c=1,i=2;function a(e,t,n){e.button===c?Object(r.a)("MouseMiddleButton",t,n):e.button===i&&Object(r.a)("MouseRightButton",t,n)}},9001:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(254),c=n(428),i=n(2390),a=n(6328);function o(e,t,n,o){var u,s,f=Date.now(),d=new r.a("ServiceGeneratedLinkClickHandler"),l="CT="+f+"&OR=OWA-"+(e?e.ctrlKey||1===e.button?"NTB":e.shiftKey?"NW":"NT":"NT")+"&CID="+Object(c.a)(),b=e.currentTarget,p=(s=new URL(b.href),["CID","OR","CT"].forEach((function(e){var t;(null===(t=s.searchParams)||void 0===t?void 0:t.get(e))&&s.searchParams.delete(e)})),s);if(t){var O=p.href,v=O.indexOf(i.c);if(-1===v)return;var h=encodeURIComponent(btoa(l));u=O.substr(0,v)+"&xdata="+h+i.c}else{var j=p.href.indexOf("?")>=0?"&":"?";u=p.href+j+l}d.end(),window.open(u),e.preventDefault(),Object(a.a)(o||(e.altKey?"AltKey":e.ctrlKey?"CtrlKey":e.metaKey?"MetaKey":e.shiftKey?"ShiftKey":"Default"),t,n)}},966:function(e,t,n){"use strict";var r=n(972),c=n(1361),i=n(9);function a(e){var t;return e>=1073741824?(e/=1073741824,t=Object(i.b)(c.b)):e>=1048576?(e/=1048576,t=Object(i.b)(c.d)):e>=1024?(e/=1024,t=Object(i.b)(c.c)):t=Object(i.b)(c.a),Object(i.c)(t,Math.round(e))}var o,u=n(1091),s=n(76),f=[".pdf",".doc",".docx",".odt",".rtf",".ppt",".pptx",".pptm",".potx",".potm",".pot",".ppxx",".pps",".odp"];function d(e){if(!Object(s.h)("doc-attachment-documentThumbnail"))return!1;var t=Object(r.a)(e);return!!t&&f.indexOf(t.toLowerCase())>=0}function l(e){switch(e){case".doc":case".docm":case".docx":case".dot":case".dotm":case".dotx":case".odt":case".rtf":return o.Word;case".csv":case".ods":case".xls":case".xlsb":case".xlsm":case".xlsx":return o.Excel;case".odp":case".pot":case".potm":case".potx":case".pps":case".ppsm":case".ppsx":case".ppt":case".pptm":case".pptx":return o.PowerPoint;default:return null}}!function(e){e[e.Word=0]="Word",e[e.Excel=1]="Excel",e[e.PowerPoint=2]="PowerPoint"}(o||(o={}));var b=n(1011);n.d(t,"b",(function(){return r.a})),n.d(t,"c",(function(){return r.b})),n.d(t,"d",(function(){return r.c})),n.d(t,"i",(function(){return a})),n.d(t,"g",(function(){return u.a})),n.d(t,"h",(function(){return d})),n.d(t,"f",(function(){return l})),n.d(t,"e",(function(){return b.b})),n.d(t,"a",(function(){return o}))},972:function(e,t,n){"use strict";function r(e){if(!e)return null;var t=e.lastIndexOf(".");return t>0?e.substr(t).toLowerCase():null}function c(e){var t=r(e);return t?t.replace(".",""):null}function i(e){var t;return(null===(t=c(e))||void 0===t?void 0:t.substring(0,4))||""}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return c})),n.d(t,"c",(function(){return i}))}}]);
//# sourceMappingURL=owa.SharePointLink.js.map
self.scriptsLoaded['owa.SharePointLink.js'] = 1; self.scriptProcessEnd = self.scriptProcessEnd || {}; self.scriptProcessEnd['owa.SharePointLink.js'] = (new Date()).getTime();